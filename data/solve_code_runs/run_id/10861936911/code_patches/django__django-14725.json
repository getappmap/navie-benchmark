{
  "instance_id": "django__django-14725",
  "edit_test_file": "tests/model_formsets_regress/tests.py",
  "code_patch": "diff --git a/django/forms/formsets.py b/django/forms/formsets.py\nindex 75b0646..f665be0 100644\n--- a/django/forms/formsets.py\n+++ b/django/forms/formsets.py\n@@ -63,10 +63,11 @@ class BaseFormSet(RenderableFormMixin):\n     template_name_p = 'django/forms/formsets/p.html'\n     template_name_table = 'django/forms/formsets/table.html'\n     template_name_ul = 'django/forms/formsets/ul.html'\n+    edit_only = False\n \n     def __init__(self, data=None, files=None, auto_id='id_%s', prefix=None,\n                  initial=None, error_class=ErrorList, form_kwargs=None,\n-                 error_messages=None):\n+                 error_messages=None, edit_only=False):\n         self.is_bound = data is not None or files is not None\n         self.prefix = prefix or self.get_default_prefix()\n         self.auto_id = auto_id\n@@ -77,6 +78,7 @@ class BaseFormSet(RenderableFormMixin):\n         self.error_class = error_class\n         self._errors = None\n         self._non_form_errors = None\n+        self.edit_only = edit_only\n \n         messages = {}\n         for cls in reversed(type(self).__mro__):\n@@ -146,7 +148,10 @@ class BaseFormSet(RenderableFormMixin):\n             # count in the data; this is DoS protection to prevent clients\n             # from forcing the server to instantiate arbitrary numbers of\n             # forms\n-            return min(self.management_form.cleaned_data[TOTAL_FORM_COUNT], self.absolute_max)\n+            total_count = min(self.management_form.cleaned_data[TOTAL_FORM_COUNT], self.absolute_max)\n+            if self.edit_only:\n+                total_count = min(total_count, self.initial_form_count())\n+            return total_count\n         else:\n             initial_forms = self.initial_form_count()\n             total_forms = max(initial_forms, self.min_num) + self.extra\n@@ -187,6 +192,9 @@ class BaseFormSet(RenderableFormMixin):\n \n     def _construct_form(self, i, **kwargs):\n         \"\"\"Instantiate and return the i-th form instance in a formset.\"\"\"\n+        if self.edit_only and i >= self.initial_form_count():\n+            raise IndexError(\"Cannot construct form beyond initial count in edit-only mode.\")\n+        \n         defaults = {\n             'auto_id': self.auto_id,\n             'prefix': self.add_prefix(i),\n@@ -347,8 +355,9 @@ class BaseFormSet(RenderableFormMixin):\n         # List comprehension ensures is_valid() is called for all forms.\n         # Forms due to be deleted shouldn't cause the formset to be invalid.\n         forms_valid = all([\n-            form.is_valid() for form in self.forms\n-            if not (self.can_delete and self._should_delete_form(form))\n+            form.is_valid() for i, form in enumerate(self.forms)\n+            if not (self.can_delete and self._should_delete_form(form)) and\n+            (not self.edit_only or i < self.initial_form_count())\n         ])\n         return forms_valid and not self.non_form_errors()\n \n@@ -378,6 +387,8 @@ class BaseFormSet(RenderableFormMixin):\n             self._non_form_errors.append(error)\n \n         for i, form in enumerate(self.forms):\n+            if self.edit_only and i >= self.initial_form_count():\n+                continue\n             # Empty forms are unchanged forms beyond those with initial data.\n             if not form.has_changed() and i >= self.initial_form_count():\n                 empty_forms_count += 1\n",
  "test_patch": "diff --git a/tests/model_formsets_regress/test_model_formset_disallow_creation.py b/tests/model_formsets_regress/test_model_formset_disallow_creation.py\nnew file mode 100644\nindex 0000000..f362c06\n--- /dev/null\n+++ b/tests/model_formsets_regress/test_model_formset_disallow_creation.py\n@@ -0,0 +1,26 @@\n+from django.forms.models import modelformset_factory\n+from django.test import TestCase\n+from .models import User\n+\n+class ModelFormsetDisallowCreationTests(TestCase):\n+    def test_disallow_new_object_creation(self):\n+        \"\"\"\n+        Test to reproduce the issue where model formsets do not provide a way\n+        to disallow new object creation.\n+        \"\"\"\n+        # Create a formset with extra=0 to attempt to disallow new object creation\n+        UserFormSet = modelformset_factory(User, fields=\"__all__\", extra=0)\n+        \n+        # Simulate POST data that attempts to create a new object\n+        data = {\n+            'form-TOTAL_FORMS': '1',\n+            'form-INITIAL_FORMS': '0',\n+            'form-MAX_NUM_FORMS': '0',\n+            'form-0-username': 'new_user',\n+            'form-0-serial': '1',\n+        }\n+        \n+        formset = UserFormSet(data)\n+        \n+        # The formset should not be valid if new object creation is disallowed\n+        self.assertTrue(formset.is_valid(), \"Formset should not allow new object creation but it does.\")\n\\ No newline at end of file\n",
  "test_inverted_patch": "diff --git a/tests/model_formsets_regress/test_model_formset_disallow_creation_inverted.py b/tests/model_formsets_regress/test_model_formset_disallow_creation_inverted.py\nnew file mode 100644\nindex 0000000..a30e3b1\n--- /dev/null\n+++ b/tests/model_formsets_regress/test_model_formset_disallow_creation_inverted.py\n@@ -0,0 +1,27 @@\n+from django.forms.models import modelformset_factory\n+from django.test import TestCase\n+from .models import User\n+\n+class ModelFormsetDisallowCreationTests(TestCase):\n+    def test_disallow_new_object_creation(self):\n+        \"\"\"\n+        Test to reproduce the issue where model formsets do not provide a way\n+        to disallow new object creation.\n+        \"\"\"\n+        # Create a formset with extra=0 to attempt to disallow new object creation\n+        UserFormSet = modelformset_factory(User, fields=\"__all__\", extra=0)\n+        \n+        # Simulate POST data that attempts to create a new object\n+        data = {\n+            'form-TOTAL_FORMS': '1',\n+            'form-INITIAL_FORMS': '0',\n+            'form-MAX_NUM_FORMS': '0',\n+            'form-0-username': 'new_user',\n+            'form-0-serial': '1',\n+        }\n+        \n+        formset = UserFormSet(data)\n+        \n+        # The formset should not be valid if new object creation is disallowed\n+        if formset.is_valid():\n+            raise AssertionError(\"__BUG__HERE__\")\n\\ No newline at end of file\n",
  "num_sent_chars": 1246026,
  "num_received_chars": 156332,
  "elapsed_time": 875.6816654205322,
  "lint_repair_count": 2,
  "test_generation_attempts": 0,
  "code_generation_attempts": 12,
  "pass_to_pass": true,
  "pass_to_fail": false,
  "fail_to_pass": false,
  "code_patch_score": 1,
  "appmap_data_test_status": "PASSED",
  "appmap_data_file_count": 1,
  "appmap_data_context_size": 165406
}