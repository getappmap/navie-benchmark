{
  "instance_id": "sphinx-doc__sphinx-10673",
  "edit_test_file": "tests/test_environment_toctree.py",
  "code_patch": "diff --git a/sphinx/domains/std.py b/sphinx/domains/std.py\nindex b0d21b4..3a79101 100644\n--- a/sphinx/domains/std.py\n+++ b/sphinx/domains/std.py\n@@ -597,6 +597,7 @@ class StandardDomain(Domain):\n             'modindex': ('py-modindex', ''),\n             'search':   ('search', ''),\n         },\n+        'special_pages': {'genindex', 'py-modindex', 'search'},  # built-in special pages\n     }\n \n     dangling_warnings = {\n@@ -725,6 +726,10 @@ class StandardDomain(Domain):\n                 self.anonlabels[key] = data\n \n     def process_doc(self, env: \"BuildEnvironment\", docname: str, document: nodes.document) -> None:  # NOQA\n+        # Initialize special_pages in data if not present\n+        if 'special_pages' not in self.data:\n+            self.data['special_pages'] = {'genindex', 'py-modindex', 'search'}\n+\n         for name, explicit in document.nametypes.items():\n             if not explicit:\n                 continue\n@@ -919,7 +924,7 @@ class StandardDomain(Domain):\n         # directly reference to document by source name; can be absolute or relative\n         refdoc = node.get('refdoc', fromdocname)\n         docname = docname_join(refdoc, node['reftarget'])\n-        if docname not in env.all_docs:\n+        if docname not in env.all_docs and not self.is_special_page(docname):\n             return None\n         else:\n             if node['refexplicit']:\n@@ -1033,6 +1038,10 @@ class StandardDomain(Domain):\n     def is_enumerable_node(self, node: Node) -> bool:\n         return node.__class__ in self.enumerable_nodes\n \n+    def is_special_page(self, docname: str) -> bool:\n+        \"\"\"Check if a document name refers to a built-in special page.\"\"\"\n+        return docname in self.data.get('special_pages', set())\n+\n     def get_numfig_title(self, node: Node) -> Optional[str]:\n         \"\"\"Get the title of enumerable nodes to refer them using its title\"\"\"\n         if self.is_enumerable_node(node):\n",
  "test_patch": "diff --git a/tests/test_ext_toctree_genindex.py b/tests/test_ext_toctree_genindex.py\nnew file mode 100644\nindex 0000000..ee716dc\n--- /dev/null\n+++ b/tests/test_ext_toctree_genindex.py\n@@ -0,0 +1,65 @@\n+import unittest\n+from sphinx.application import Sphinx\n+from sphinx.errors import ApplicationError\n+from io import StringIO\n+import os\n+\n+class TestToctreeGenindexModindexSearch(unittest.TestCase):\n+    def setUp(self):\n+        # Setup paths for the Sphinx application\n+        self.srcdir = os.path.abspath('testdocs')\n+        self.confdir = self.srcdir\n+        self.outdir = os.path.join(self.srcdir, '_build')\n+        self.doctreedir = os.path.join(self.outdir, 'doctrees')\n+        self.buildername = 'html'\n+\n+        # Create necessary directories\n+        os.makedirs(self.outdir, exist_ok=True)\n+        os.makedirs(self.doctreedir, exist_ok=True)\n+\n+        # Create a minimal conf.py\n+        with open(os.path.join(self.confdir, 'conf.py'), 'w') as f:\n+            f.write(\"project = 'Test Project'\\n\")\n+\n+        # Create a minimal index.rst with the toctree\n+        with open(os.path.join(self.srcdir, 'index.rst'), 'w') as f:\n+            f.write(\"\"\"\n+.. toctree::\n+   :maxdepth: 1\n+   :caption: Indices and tables\n+\n+   genindex\n+   modindex\n+   search\n+\"\"\")\n+\n+    def tearDown(self):\n+        # Clean up created files and directories\n+        if os.path.exists(self.outdir):\n+            for root, dirs, files in os.walk(self.outdir, topdown=False):\n+                for name in files:\n+                    os.remove(os.path.join(root, name))\n+                for name in dirs:\n+                    os.rmdir(os.path.join(root, name))\n+            os.rmdir(self.outdir)\n+\n+    def test_toctree_references(self):\n+        # Redirect stdout and stderr\n+        status = StringIO()\n+        warning = StringIO()\n+\n+        # Initialize Sphinx application\n+        try:\n+            app = Sphinx(self.srcdir, self.confdir, self.outdir, self.doctreedir, self.buildername, status=status, warning=warning)\n+            app.build()\n+        except ApplicationError as e:\n+            self.fail(f\"Sphinx application error: {e}\")\n+\n+        # Check for warnings about nonexisting documents\n+        warnings = warning.getvalue()\n+        self.assertIn(\"toctree contains reference to nonexisting document 'genindex'\", warnings)\n+        self.assertIn(\"toctree contains reference to nonexisting document 'modindex'\", warnings)\n+        self.assertIn(\"toctree contains reference to nonexisting document 'search'\", warnings)\n+\n+if __name__ == '__main__':\n+    unittest.main()\n",
  "test_inverted_patch": "diff --git a/tests/test_ext_toctree_genindex_inverted.py b/tests/test_ext_toctree_genindex_inverted.py\nnew file mode 100644\nindex 0000000..19dac1b\n--- /dev/null\n+++ b/tests/test_ext_toctree_genindex_inverted.py\n@@ -0,0 +1,68 @@\n+import unittest\n+from sphinx.application import Sphinx\n+from sphinx.errors import ApplicationError\n+from io import StringIO\n+import os\n+\n+class TestToctreeGenindexModindexSearch(unittest.TestCase):\n+    def setUp(self):\n+        # Setup paths for the Sphinx application\n+        self.srcdir = os.path.abspath('testdocs')\n+        self.confdir = self.srcdir\n+        self.outdir = os.path.join(self.srcdir, '_build')\n+        self.doctreedir = os.path.join(self.outdir, 'doctrees')\n+        self.buildername = 'html'\n+\n+        # Create necessary directories\n+        os.makedirs(self.outdir, exist_ok=True)\n+        os.makedirs(self.doctreedir, exist_ok=True)\n+\n+        # Create a minimal conf.py\n+        with open(os.path.join(self.confdir, 'conf.py'), 'w') as f:\n+            f.write(\"project = 'Test Project'\\n\")\n+\n+        # Create a minimal index.rst with the toctree\n+        with open(os.path.join(self.srcdir, 'index.rst'), 'w') as f:\n+            f.write(\"\"\"\n+.. toctree::\n+   :maxdepth: 1\n+   :caption: Indices and tables\n+\n+   genindex\n+   modindex\n+   search\n+\"\"\")\n+\n+    def tearDown(self):\n+        # Clean up created files and directories\n+        if os.path.exists(self.outdir):\n+            for root, dirs, files in os.walk(self.outdir, topdown=False):\n+                for name in files:\n+                    os.remove(os.path.join(root, name))\n+                for name in dirs:\n+                    os.rmdir(os.path.join(root, name))\n+            os.rmdir(self.outdir)\n+\n+    def test_toctree_references(self):\n+        # Redirect stdout and stderr\n+        status = StringIO()\n+        warning = StringIO()\n+\n+        # Initialize Sphinx application\n+        try:\n+            app = Sphinx(self.srcdir, self.confdir, self.outdir, self.doctreedir, self.buildername, status=status, warning=warning)\n+            app.build()\n+        except ApplicationError as e:\n+            self.fail(f\"Sphinx application error: {e}\")\n+\n+        # Check for warnings about nonexisting documents\n+        warnings = warning.getvalue()\n+        if \"toctree contains reference to nonexisting document 'genindex'\" in warnings:\n+            raise AssertionError(\"__BUG__HERE__\")\n+        if \"toctree contains reference to nonexisting document 'modindex'\" in warnings:\n+            raise AssertionError(\"__BUG__HERE__\")\n+        if \"toctree contains reference to nonexisting document 'search'\" in warnings:\n+            raise AssertionError(\"__BUG__HERE__\")\n+\n+if __name__ == '__main__':\n+    unittest.main()\n",
  "num_sent_chars": 4526445,
  "num_received_chars": 74549,
  "elapsed_time": 804.5227031707764,
  "lint_repair_count": 5,
  "test_generation_attempts": 0,
  "code_generation_attempts": 9,
  "pass_to_pass": true,
  "pass_to_fail": false,
  "fail_to_pass": false,
  "code_patch_score": 1,
  "appmap_data_test_status": null,
  "appmap_data_file_count": null,
  "appmap_data_context_size": null
}