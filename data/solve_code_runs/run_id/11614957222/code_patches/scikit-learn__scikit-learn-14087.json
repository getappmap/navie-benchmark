{
  "instance_id": "scikit-learn__scikit-learn-14087",
  "edit_test_file": "sklearn/linear_model/tests/test_logistic.py",
  "code_patch": "diff --git a/sklearn/linear_model/logistic.py b/sklearn/linear_model/logistic.py\nindex 1999f1d..809280a 100644\n--- a/sklearn/linear_model/logistic.py\n+++ b/sklearn/linear_model/logistic.py\n@@ -2174,7 +2174,8 @@ class LogisticRegressionCV(LogisticRegression, BaseEstimator,\n                     w = np.mean([coefs_paths[i, best_indices[i], :]\n                                  for i in range(len(folds))], axis=0)\n                 else:\n-                    w = np.mean([coefs_paths[:, i, best_indices[i], :]\n+                    # For multinomial case, properly handle the coefficient array shape\n+                    w = np.mean([coefs_paths[..., i, best_indices[i], :]\n                                  for i in range(len(folds))], axis=0)\n \n                 best_indices_C = best_indices % len(self.Cs_)\n",
  "test_patch": "diff --git a/sklearn/linear_model/tests/test_logistic_regression_cv.py b/sklearn/linear_model/tests/test_logistic_regression_cv.py\nnew file mode 100644\nindex 0000000..7cb12d6\n--- /dev/null\n+++ b/sklearn/linear_model/tests/test_logistic_regression_cv.py\n@@ -0,0 +1,14 @@\n+import numpy as np\n+from sklearn.linear_model import LogisticRegressionCV\n+from sklearn.utils.testing import assert_raises\n+\n+def test_logistic_regression_cv_refit_false_index_error():\n+    # Reproduce IndexError when refit=False in LogisticRegressionCV\n+    np.random.seed(29)\n+    X = np.random.normal(size=(1000, 3))\n+    beta = np.random.normal(size=3)\n+    intercept = np.random.normal(size=None)\n+    y = np.sign(intercept + X @ beta)\n+\n+    # Expecting an IndexError due to the issue described\n+    assert_raises(IndexError, LogisticRegressionCV(cv=5, solver='saga', tol=1e-2, refit=False).fit, X, y)\n",
  "test_inverted_patch": "diff --git a/sklearn/linear_model/tests/test_logistic_regression_cv_inverted.py b/sklearn/linear_model/tests/test_logistic_regression_cv_inverted.py\nnew file mode 100644\nindex 0000000..a2d5bae\n--- /dev/null\n+++ b/sklearn/linear_model/tests/test_logistic_regression_cv_inverted.py\n@@ -0,0 +1,17 @@\n+import numpy as np\n+from sklearn.linear_model import LogisticRegressionCV\n+\n+def test_logistic_regression_cv_refit_false_index_error():\n+    # Reproduce IndexError when refit=False in LogisticRegressionCV\n+    np.random.seed(29)\n+    X = np.random.normal(size=(1000, 3))\n+    beta = np.random.normal(size=3)\n+    intercept = np.random.normal(size=None)\n+    y = np.sign(intercept + X @ beta)\n+\n+    try:\n+        LogisticRegressionCV(cv=5, solver='saga', tol=1e-2, refit=False).fit(X, y)\n+    except IndexError:\n+        raise AssertionError(\"__BUG__HERE__\")\n+    else:\n+        raise AssertionError(\"Expected IndexError was not raised\")\n",
  "num_sent_chars": 4056075,
  "num_received_chars": 65837,
  "elapsed_time": 736.1188998222351,
  "lint_repair_count": 3,
  "test_generation_attempts": 0,
  "code_generation_attempts": 9,
  "pass_to_pass": true,
  "pass_to_fail": true,
  "fail_to_pass": false,
  "code_patch_score": 2,
  "appmap_data_test_status": null,
  "appmap_data_file_count": null,
  "appmap_data_context_size": null
}