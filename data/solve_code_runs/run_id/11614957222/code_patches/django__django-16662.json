{
  "instance_id": "django__django-16662",
  "edit_test_file": "tests/template_backends/test_django.py",
  "code_patch": "diff --git a/django/db/migrations/autodetector.py b/django/db/migrations/autodetector.py\nindex 23c97e5..9b623fc 100644\n--- a/django/db/migrations/autodetector.py\n+++ b/django/db/migrations/autodetector.py\n@@ -5,17 +5,12 @@ from graphlib import TopologicalSorter\n from itertools import chain\n \n from django.conf import settings\n-from django.db import models\n from django.db.migrations import operations\n from django.db.migrations.migration import Migration\n from django.db.migrations.operations.models import AlterModelOptions\n from django.db.migrations.optimizer import MigrationOptimizer\n from django.db.migrations.questioner import MigrationQuestioner\n-from django.db.migrations.utils import (\n-    COMPILED_REGEX_TYPE,\n-    RegexObject,\n-    resolve_relation,\n-)\n+\n \n \n class MigrationAutodetector:\n@@ -37,6 +32,21 @@ class MigrationAutodetector:\n         self.questioner = questioner or MigrationQuestioner()\n         self.existing_apps = {app for app, model in from_state.models}\n \n+    @staticmethod\n+    def _sort_imports(imports):\n+        \"\"\"\n+        Sort imports according to Django's coding style:\n+        1. Standard import statements\n+        2. From import statements\n+        Within each group:\n+        - Alphabetically sorted\n+        - Direct imports before from imports\n+        \"\"\"\n+        standard_imports = sorted([imp for imp in imports if imp.startswith('import ')])\n+        from_imports = sorted([imp for imp in imports if imp.startswith('from ')])\n+        \n+        return standard_imports + from_imports\n+\n     def changes(self, graph, trim_to_apps=None, convert_apps=None, migration_name=None):\n         \"\"\"\n         Main entry point to produce a list of applicable changes.\n",
  "test_patch": "diff --git a/tests/template_backends/test_migration_import_ordering.py b/tests/template_backends/test_migration_import_ordering.py\nnew file mode 100644\nindex 0000000..152b546\n--- /dev/null\n+++ b/tests/template_backends/test_migration_import_ordering.py\n@@ -0,0 +1,27 @@\n+import unittest\n+from pathlib import Path\n+\n+class TestMigrationImportOrdering(unittest.TestCase):\n+    def test_migration_import_ordering(self):\n+        # Path to the migration file to be tested\n+        migration_file_path = Path(__file__).parent.parent / \"migrations\" / \"test_migrations_order\" / \"0001.py\"\n+        \n+        # Read the content of the migration file\n+        with open(migration_file_path, \"r\") as file:\n+            content = file.readlines()\n+        \n+        # Check the order of imports\n+        import_statements = [line.strip() for line in content if line.startswith(\"import\") or line.startswith(\"from\")]\n+        \n+        # Expected order of imports\n+        expected_order = [\n+            \"import datetime\",\n+            \"import time\",\n+            \"from django.db import migrations, models\"\n+        ]\n+        \n+        # Assert that the import statements are not in the expected order\n+        self.assertNotEqual(import_statements, expected_order, \"Migration imports are in the correct order, expected them to be incorrect.\")\n+\n+if __name__ == \"__main__\":\n+    unittest.main()\n",
  "test_inverted_patch": "diff --git a/tests/template_backends/test_migration_import_ordering_inverted.py b/tests/template_backends/test_migration_import_ordering_inverted.py\nnew file mode 100644\nindex 0000000..a471063\n--- /dev/null\n+++ b/tests/template_backends/test_migration_import_ordering_inverted.py\n@@ -0,0 +1,28 @@\n+import unittest\n+from pathlib import Path\n+\n+class TestMigrationImportOrdering(unittest.TestCase):\n+    def test_migration_import_ordering(self):\n+        # Path to the migration file to be tested\n+        migration_file_path = Path(__file__).parent.parent / \"migrations\" / \"test_migrations_order\" / \"0001.py\"\n+        \n+        # Read the content of the migration file\n+        with open(migration_file_path, \"r\") as file:\n+            content = file.readlines()\n+        \n+        # Check the order of imports\n+        import_statements = [line.strip() for line in content if line.startswith(\"import\") or line.startswith(\"from\")]\n+        \n+        # Expected order of imports\n+        expected_order = [\n+            \"import datetime\",\n+            \"import time\",\n+            \"from django.db import migrations, models\"\n+        ]\n+        \n+        # Assert that the import statements are in the expected order\n+        # This will now fail if the imports are not in the expected order\n+        self.assertEqual(import_statements, expected_order, \"__BUG__HERE__\")\n+\n+if __name__ == \"__main__\":\n+    unittest.main()\n",
  "num_sent_chars": 5866932,
  "num_received_chars": 59125,
  "elapsed_time": 876.5564346313477,
  "lint_repair_count": 11,
  "test_generation_attempts": 0,
  "code_generation_attempts": 9,
  "pass_to_pass": true,
  "pass_to_fail": false,
  "fail_to_pass": false,
  "code_patch_score": 1,
  "appmap_data_test_status": null,
  "appmap_data_file_count": null,
  "appmap_data_context_size": null
}