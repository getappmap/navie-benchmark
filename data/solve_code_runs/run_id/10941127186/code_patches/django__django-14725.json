{
  "instance_id": "django__django-14725",
  "edit_test_file": "tests/model_formsets/tests.py",
  "code_patch": "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 7effb20..29609b1 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -573,9 +573,10 @@ class BaseModelFormSet(BaseFormSet):\n     unique_fields = set()\n \n     def __init__(self, data=None, files=None, auto_id='id_%s', prefix=None,\n-                 queryset=None, *, initial=None, **kwargs):\n+                 queryset=None, *, initial=None, allow_new=True, **kwargs):\n         self.queryset = queryset\n         self.initial_extra = initial\n+        self.allow_new = allow_new\n         super().__init__(**{'data': data, 'files': files, 'auto_id': auto_id, 'prefix': prefix, **kwargs})\n \n     def initial_form_count(self):\n@@ -812,6 +813,9 @@ class BaseModelFormSet(BaseFormSet):\n         return saved_instances\n \n     def save_new_objects(self, commit=True):\n+        if not self.allow_new:\n+            raise ValidationError(\"New object creation is not allowed in this formset.\")\n+        \n         self.new_objects = []\n         for form in self.extra_forms:\n             if not form.has_changed():\n",
  "test_patch": "diff --git a/tests/model_formsets/test_model_formset_edit_only.py b/tests/model_formsets/test_model_formset_edit_only.py\nnew file mode 100644\nindex 0000000..712e23b\n--- /dev/null\n+++ b/tests/model_formsets/test_model_formset_edit_only.py\n@@ -0,0 +1,39 @@\n+import datetime\n+from django import forms\n+from django.forms.models import modelformset_factory\n+from django.test import TestCase\n+from .models import Author\n+\n+class ModelFormsetEditOnlyTest(TestCase):\n+    def test_edit_only_formset_allows_new_object_creation(self):\n+        \"\"\"\n+        Test that a model formset with extra=0 still allows new object creation,\n+        which is not the intended behavior for an \"edit only\" view.\n+        \"\"\"\n+        # Create an initial author to edit\n+        author = Author.objects.create(name='Existing Author')\n+\n+        # Create a formset with extra=0, intending to only edit existing authors\n+        AuthorFormSet = modelformset_factory(Author, fields=\"__all__\", extra=0)\n+\n+        # Simulate POST data that includes an additional form for a new author\n+        data = {\n+            'form-TOTAL_FORMS': '2',  # 1 existing + 1 new\n+            'form-INITIAL_FORMS': '1',  # 1 existing\n+            'form-MAX_NUM_FORMS': '',  # no max\n+            'form-0-id': str(author.id),\n+            'form-0-name': 'Updated Author',\n+            'form-1-id': '',  # New form\n+            'form-1-name': 'New Author',\n+        }\n+\n+        formset = AuthorFormSet(data=data, queryset=Author.objects.all())\n+\n+        # The formset should be valid, but this is not the intended behavior\n+        # for an \"edit only\" view, as it allows new object creation.\n+        self.assertTrue(formset.is_valid())\n+\n+        # Save the formset and check that a new author was created\n+        formset.save()\n+        self.assertEqual(Author.objects.count(), 2)\n+        self.assertTrue(Author.objects.filter(name='New Author').exists())\n\\ No newline at end of file\n",
  "test_inverted_patch": "diff --git a/tests/model_formsets/test_model_formset_edit_only_inverted.py b/tests/model_formsets/test_model_formset_edit_only_inverted.py\nnew file mode 100644\nindex 0000000..e88e2da\n--- /dev/null\n+++ b/tests/model_formsets/test_model_formset_edit_only_inverted.py\n@@ -0,0 +1,39 @@\n+import datetime\n+from django import forms\n+from django.forms.models import modelformset_factory\n+from django.test import TestCase\n+from .models import Author\n+\n+class ModelFormsetEditOnlyTest(TestCase):\n+    def test_edit_only_formset_disallows_new_object_creation(self):\n+        \"\"\"\n+        Test that a model formset with extra=0 disallows new object creation,\n+        which is the intended behavior for an \"edit only\" view.\n+        \"\"\"\n+        # Create an initial author to edit\n+        author = Author.objects.create(name='Existing Author')\n+\n+        # Create a formset with extra=0, intending to only edit existing authors\n+        AuthorFormSet = modelformset_factory(Author, fields=\"__all__\", extra=0)\n+\n+        # Simulate POST data that includes an additional form for a new author\n+        data = {\n+            'form-TOTAL_FORMS': '2',  # 1 existing + 1 new\n+            'form-INITIAL_FORMS': '1',  # 1 existing\n+            'form-MAX_NUM_FORMS': '',  # no max\n+            'form-0-id': str(author.id),\n+            'form-0-name': 'Updated Author',\n+            'form-1-id': '',  # New form\n+            'form-1-name': 'New Author',\n+        }\n+\n+        formset = AuthorFormSet(data=data, queryset=Author.objects.all())\n+\n+        # The formset should not be valid, as it should disallow new object creation\n+        if formset.is_valid():\n+            raise AssertionError(\"__BUG__HERE__\")\n+\n+        # Ensure no new author was created\n+        formset.save()\n+        self.assertEqual(Author.objects.count(), 1)\n+        self.assertFalse(Author.objects.filter(name='New Author').exists())\n\\ No newline at end of file\n",
  "num_sent_chars": 1288362,
  "num_received_chars": 151201,
  "elapsed_time": 562.6340129375458,
  "lint_repair_count": 1,
  "test_generation_attempts": 1,
  "code_generation_attempts": 9,
  "pass_to_pass": true,
  "pass_to_fail": false,
  "fail_to_pass": false,
  "code_patch_score": 1,
  "appmap_data_test_status": null,
  "appmap_data_file_count": null,
  "appmap_data_context_size": null
}