{
  "instance_id": "scikit-learn__scikit-learn-14710",
  "edit_test_file": "sklearn/ensemble/_hist_gradient_boosting/tests/test_gradient_boosting.py",
  "code_patch": "diff --git a/sklearn/ensemble/_hist_gradient_boosting/gradient_boosting.py b/sklearn/ensemble/_hist_gradient_boosting/gradient_boosting.py\nindex ad6a5a8..1b520fa 100644\n--- a/sklearn/ensemble/_hist_gradient_boosting/gradient_boosting.py\n+++ b/sklearn/ensemble/_hist_gradient_boosting/gradient_boosting.py\n@@ -14,6 +14,7 @@ from ...utils.multiclass import check_classification_targets\n from ...metrics import check_scoring\n from ...model_selection import train_test_split\n from ...preprocessing import LabelEncoder\n+from ...utils.multiclass import type_of_target\n from ._gradient_boosting import _update_raw_predictions\n from .common import Y_DTYPE, X_DTYPE, X_BINNED_DTYPE\n \n@@ -426,11 +427,19 @@ class BaseHistGradientBoosting(BaseEstimator, ABC):\n \n         Scores are computed on validation data or on training data.\n         \"\"\"\n+        # Ensure y_small_train is encoded if necessary\n+        if type_of_target(y_small_train) == 'binary' or type_of_target(y_small_train) == 'multiclass':\n+            y_small_train = self._encode_y(y_small_train)\n+        \n         self.train_score_.append(\n             self.scorer_(self, X_binned_small_train, y_small_train)\n         )\n \n         if self._use_validation_data:\n+            # Ensure y_val is encoded if necessary\n+            if type_of_target(y_val) == 'binary' or type_of_target(y_val) == 'multiclass':\n+                y_val = self._encode_y(y_val)\n+            \n             self.validation_score_.append(\n                 self.scorer_(self, X_binned_val, y_val)\n             )\n",
  "test_patch": "diff --git a/sklearn/ensemble/_hist_gradient_boosting/tests/test_early_stopping_classifier.py b/sklearn/ensemble/_hist_gradient_boosting/tests/test_early_stopping_classifier.py\nnew file mode 100644\nindex 0000000..6d7a049\n--- /dev/null\n+++ b/sklearn/ensemble/_hist_gradient_boosting/tests/test_early_stopping_classifier.py\n@@ -0,0 +1,12 @@\n+import numpy as np\n+import pytest\n+from sklearn.experimental import enable_hist_gradient_boosting  # noqa\n+from sklearn.ensemble import HistGradientBoostingClassifier\n+\n+def test_early_stopping_with_string_target():\n+    X = np.random.randn(100, 10)\n+    y = np.array(['x'] * 50 + ['y'] * 50, dtype=object)\n+    gbrt = HistGradientBoostingClassifier(n_iter_no_change=10)\n+    \n+    with pytest.raises(TypeError, match=\"<' not supported between instances of 'str' and 'float'\"):\n+        gbrt.fit(X, y)\n\\ No newline at end of file\n",
  "test_inverted_patch": "diff --git a/sklearn/ensemble/_hist_gradient_boosting/tests/test_early_stopping_classifier_inverted.py b/sklearn/ensemble/_hist_gradient_boosting/tests/test_early_stopping_classifier_inverted.py\nnew file mode 100644\nindex 0000000..80ad9a0\n--- /dev/null\n+++ b/sklearn/ensemble/_hist_gradient_boosting/tests/test_early_stopping_classifier_inverted.py\n@@ -0,0 +1,19 @@\n+import numpy as np\n+import pytest\n+from sklearn.experimental import enable_hist_gradient_boosting  # noqa\n+from sklearn.ensemble import HistGradientBoostingClassifier\n+\n+def test_early_stopping_with_string_target():\n+    X = np.random.randn(100, 10)\n+    y = np.array(['x'] * 50 + ['y'] * 50, dtype=object)\n+    gbrt = HistGradientBoostingClassifier(n_iter_no_change=10)\n+    \n+    try:\n+        gbrt.fit(X, y)\n+    except TypeError as e:\n+        if \"<' not supported between instances of 'str' and 'float'\" in str(e):\n+            raise AssertionError(\"__BUG__HERE__\")\n+        else:\n+            raise e\n+    else:\n+        raise AssertionError(\"__BUG__HERE__\")\n\\ No newline at end of file\n",
  "num_sent_chars": 1368797,
  "num_received_chars": 46775,
  "elapsed_time": 658.9092829227448,
  "lint_repair_count": 1,
  "test_generation_attempts": 1,
  "code_generation_attempts": 9,
  "pass_to_pass": true,
  "pass_to_fail": true,
  "fail_to_pass": false,
  "code_patch_score": 2,
  "appmap_data_test_status": null,
  "appmap_data_file_count": null,
  "appmap_data_context_size": null
}