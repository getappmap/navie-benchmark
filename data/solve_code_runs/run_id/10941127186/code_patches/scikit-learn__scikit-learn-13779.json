{
  "instance_id": "scikit-learn__scikit-learn-13779",
  "edit_test_file": "sklearn/ensemble/tests/test_voting.py",
  "code_patch": "diff --git a/sklearn/ensemble/voting.py b/sklearn/ensemble/voting.py\nindex 7afa718..8e5c19d 100644\n--- a/sklearn/ensemble/voting.py\n+++ b/sklearn/ensemble/voting.py\n@@ -76,24 +76,25 @@ class _BaseVoting(_BaseComposition, TransformerMixin):\n                              '; got %d weights, %d estimators'\n                              % (len(self.weights), len(self.estimators)))\n \n+        valid_estimators = [(name, step) for name, step in self.estimators if step is not None]\n+\n         if sample_weight is not None:\n-            for name, step in self.estimators:\n+            for name, step in valid_estimators:\n                 if not has_fit_parameter(step, 'sample_weight'):\n                     raise ValueError('Underlying estimator \\'%s\\' does not'\n                                      ' support sample weights.' % name)\n \n-        names, clfs = zip(*self.estimators)\n-        self._validate_names(names)\n-\n-        n_isnone = np.sum([clf is None for _, clf in self.estimators])\n-        if n_isnone == len(self.estimators):\n+        if not valid_estimators:\n             raise ValueError('All estimators are None. At least one is '\n                              'required!')\n \n+        names, clfs = zip(*valid_estimators)\n+        self._validate_names(names)\n+\n         self.estimators_ = Parallel(n_jobs=self.n_jobs)(\n                 delayed(_parallel_fit_estimator)(clone(clf), X, y,\n                                                  sample_weight=sample_weight)\n-                for clf in clfs if clf is not None)\n+                for clf in clfs)\n \n         self.named_estimators_ = Bunch()\n         for k, e in zip(self.estimators, self.estimators_):\n",
  "test_patch": "diff --git a/sklearn/ensemble/tests/test_weighted_estimator.py b/sklearn/ensemble/tests/test_weighted_estimator.py\nnew file mode 100644\nindex 0000000..50bbe51\n--- /dev/null\n+++ b/sklearn/ensemble/tests/test_weighted_estimator.py\n@@ -0,0 +1,17 @@\n+import numpy as np\n+from sklearn.linear_model import LogisticRegression\n+from sklearn.ensemble import RandomForestClassifier, VotingClassifier\n+from sklearn.datasets import load_iris\n+from sklearn.utils.testing import assert_raise_message\n+\n+def test_voting_classifier_with_none_estimator_and_weights():\n+    \"\"\"Test VotingClassifier with None estimator and sample weights.\"\"\"\n+    X, y = load_iris(return_X_y=True)\n+    voter = VotingClassifier(\n+        estimators=[('lr', LogisticRegression()),\n+                    ('rf', RandomForestClassifier())]\n+    )\n+    voter.fit(X, y, sample_weight=np.ones(y.shape))\n+    voter.set_params(lr=None)\n+    msg = \"'NoneType' object has no attribute 'fit'\"\n+    assert_raise_message(AttributeError, msg, voter.fit, X, y, sample_weight=np.ones(y.shape))\n\\ No newline at end of file\n",
  "test_inverted_patch": "diff --git a/sklearn/ensemble/tests/test_weighted_estimator_inverted.py b/sklearn/ensemble/tests/test_weighted_estimator_inverted.py\nnew file mode 100644\nindex 0000000..a767d4d\n--- /dev/null\n+++ b/sklearn/ensemble/tests/test_weighted_estimator_inverted.py\n@@ -0,0 +1,19 @@\n+import numpy as np\n+from sklearn.linear_model import LogisticRegression\n+from sklearn.ensemble import RandomForestClassifier, VotingClassifier\n+from sklearn.datasets import load_iris\n+import pytest\n+\n+def test_voting_classifier_with_none_estimator_and_weights():\n+    \"\"\"Test VotingClassifier with None estimator and sample weights.\"\"\"\n+    X, y = load_iris(return_X_y=True)\n+    voter = VotingClassifier(\n+        estimators=[('lr', LogisticRegression()),\n+                    ('rf', RandomForestClassifier())]\n+    )\n+    voter.fit(X, y, sample_weight=np.ones(y.shape))\n+    voter.set_params(lr=None)\n+    \n+    # The test should now fail with the specific error message when the bug is observed\n+    with pytest.raises(AttributeError, match=\"__BUG__HERE__\"):\n+        voter.fit(X, y, sample_weight=np.ones(y.shape))\n\\ No newline at end of file\n",
  "num_sent_chars": 1137266,
  "num_received_chars": 41586,
  "elapsed_time": 313.91854786872864,
  "lint_repair_count": 0,
  "test_generation_attempts": 1,
  "code_generation_attempts": 9,
  "pass_to_pass": true,
  "pass_to_fail": true,
  "fail_to_pass": false,
  "code_patch_score": 2,
  "appmap_data_test_status": null,
  "appmap_data_file_count": null,
  "appmap_data_context_size": null
}