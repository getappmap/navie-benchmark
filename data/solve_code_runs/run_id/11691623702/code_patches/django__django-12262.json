{
  "instance_id": "django__django-12262",
  "edit_test_file": "tests/template_tests/test_custom.py",
  "code_patch": "diff --git a/django/template/library.py b/django/template/library.py\nindex 20bc86d..89645be 100644\n--- a/django/template/library.py\n+++ b/django/template/library.py\n@@ -261,16 +261,16 @@ def parse_bits(parser, bits, params, varargs, varkw, defaults,\n         if kwarg:\n             # The kwarg was successfully extracted\n             param, value = kwarg.popitem()\n-            if param not in params and param not in unhandled_kwargs and varkw is None:\n-                # An unexpected keyword argument was supplied\n-                raise TemplateSyntaxError(\n-                    \"'%s' received unexpected keyword argument '%s'\" %\n-                    (name, param))\n-            elif param in kwargs:\n+            if param in kwargs:\n                 # The keyword argument has already been supplied once\n                 raise TemplateSyntaxError(\n                     \"'%s' received multiple values for keyword argument '%s'\" %\n                     (name, param))\n+            elif param not in params and param not in kwonly and varkw is None:\n+                # An unexpected keyword argument was supplied\n+                raise TemplateSyntaxError(\n+                    \"'%s' received unexpected keyword argument '%s'\" %\n+                    (name, param))\n             else:\n                 # All good, record the keyword argument\n                 kwargs[str(param)] = value\n",
  "test_patch": "diff --git a/tests/template_tests/test_keyword_only_args.py b/tests/template_tests/test_keyword_only_args.py\nnew file mode 100644\nindex 0000000..8cad1ce\n--- /dev/null\n+++ b/tests/template_tests/test_keyword_only_args.py\n@@ -0,0 +1,39 @@\n+from django.template import Context, Engine, TemplateSyntaxError\n+from django.test import SimpleTestCase\n+\n+LIBRARIES = {\n+    'custom': 'template_tests.templatetags.custom',\n+}\n+\n+\n+class KeywordOnlyArgsTests(SimpleTestCase):\n+    @classmethod\n+    def setUpClass(cls):\n+        cls.engine = Engine(app_dirs=True, libraries=LIBRARIES)\n+        super().setUpClass()\n+\n+    def test_keyword_only_args_with_default(self):\n+        \"\"\"\n+        Test that keyword-only arguments with defaults can be provided as template\n+        tag arguments.\n+        \"\"\"\n+        template = (\n+            \"{% load custom %}\"\n+            \"{% simple_keyword_only_default kwarg='test' %}\"\n+        )\n+        msg = \"'simple_keyword_only_default' received unexpected keyword argument 'kwarg'\"\n+        with self.assertRaisesMessage(TemplateSyntaxError, msg):\n+            self.engine.from_string(template)\n+\n+    def test_duplicate_keyword_args(self):\n+        \"\"\"\n+        Test that providing a keyword argument multiple times raises the correct\n+        error message.\n+        \"\"\"\n+        template = (\n+            \"{% load custom %}\"\n+            \"{% simple_keyword_only_param kwarg='test1' kwarg='test2' %}\"\n+        )\n+        msg = \"'simple_keyword_only_param' received unexpected keyword argument 'kwarg'\"\n+        with self.assertRaisesMessage(TemplateSyntaxError, msg):\n+            self.engine.from_string(template)\n\\ No newline at end of file\n",
  "test_inverted_patch": "diff --git a/tests/template_tests/test_keyword_only_args_inverted.py b/tests/template_tests/test_keyword_only_args_inverted.py\nnew file mode 100644\nindex 0000000..7164c0e\n--- /dev/null\n+++ b/tests/template_tests/test_keyword_only_args_inverted.py\n@@ -0,0 +1,53 @@\n+from django.template import Context, Engine, TemplateSyntaxError\n+from django.test import SimpleTestCase\n+\n+LIBRARIES = {\n+    'custom': 'template_tests.templatetags.custom',\n+}\n+\n+\n+class KeywordOnlyArgsTests(SimpleTestCase):\n+    @classmethod\n+    def setUpClass(cls):\n+        cls.engine = Engine(app_dirs=True, libraries=LIBRARIES)\n+        super().setUpClass()\n+\n+    def test_keyword_only_args_with_default(self):\n+        \"\"\"\n+        Test that keyword-only arguments with defaults can be provided as template\n+        tag arguments.\n+        \"\"\"\n+        template = (\n+            \"{% load custom %}\"\n+            \"{% simple_keyword_only_default kwarg='test' %}\"\n+        )\n+        try:\n+            self.engine.from_string(template)\n+        except TemplateSyntaxError as e:\n+            if str(e) == \"'simple_keyword_only_default' received unexpected keyword argument 'kwarg'\":\n+                raise AssertionError(\"__BUG__HERE__\")\n+        else:\n+            # If no exception was raised, the test should pass\n+            pass\n+\n+    def test_duplicate_keyword_args(self):\n+        \"\"\"\n+        Test that providing a keyword argument multiple times raises the correct\n+        error message.\n+        \"\"\"\n+        template = (\n+            \"{% load custom %}\"\n+            \"{% simple_keyword_only_param kwarg='test1' kwarg='test2' %}\"\n+        )\n+        try:\n+            self.engine.from_string(template)\n+        except TemplateSyntaxError as e:\n+            if str(e) == \"'simple_keyword_only_param' received unexpected keyword argument 'kwarg'\":\n+                raise AssertionError(\"__BUG__HERE__\")\n+            # The correct error message should be about multiple values\n+            expected_msg = \"'simple_keyword_only_param' received multiple values for keyword argument 'kwarg'\"\n+            if str(e) != expected_msg:\n+                raise AssertionError(\"__BUG__HERE__\")\n+        else:\n+            # If no exception was raised, that's also incorrect\n+            raise AssertionError(\"Expected TemplateSyntaxError was not raised\")\n\\ No newline at end of file\n",
  "num_sent_chars": 3175307,
  "num_received_chars": 45152,
  "elapsed_time": 604.6391332149506,
  "lint_repair_count": 0,
  "test_generation_attempts": 0,
  "code_generation_attempts": 8,
  "pass_to_pass": true,
  "pass_to_fail": true,
  "fail_to_pass": true,
  "code_patch_score": 3,
  "appmap_data_test_status": null,
  "appmap_data_file_count": null,
  "appmap_data_context_size": null
}