{
  "instance_id": "pydata__xarray-4075",
  "edit_test_file": "xarray/tests/test_weighted.py",
  "code_patch": "diff --git a/xarray/core/weighted.py b/xarray/core/weighted.py\nindex 996d2e4..a8acce8 100644\n--- a/xarray/core/weighted.py\n+++ b/xarray/core/weighted.py\n@@ -96,6 +96,7 @@ class Weighted:\n         \"\"\"\n \n         from .dataarray import DataArray\n+        import numpy as np\n \n         if not isinstance(weights, DataArray):\n             raise ValueError(\"`weights` must be a DataArray\")\n@@ -106,6 +107,9 @@ class Weighted:\n                 \"Missing values can be replaced by `weights.fillna(0)`.\"\n             )\n \n+        # Convert boolean weights to float64 to ensure proper numeric calculations\n+        if weights.dtype == bool:\n+            weights = weights.astype(np.float64)\n         self.obj = obj\n         self.weights = weights\n \n",
  "test_patch": "diff --git a/xarray/tests/test_weighted_mean_boolean.py b/xarray/tests/test_weighted_mean_boolean.py\nnew file mode 100644\nindex 0000000..39e8313\n--- /dev/null\n+++ b/xarray/tests/test_weighted_mean_boolean.py\n@@ -0,0 +1,16 @@\n+import numpy as np\n+import xarray as xr\n+from xarray.tests import assert_equal\n+\n+def test_weighted_mean_boolean_weights():\n+    # Create a DataArray with values\n+    dta = xr.DataArray([1.0, 1.0, 1.0])\n+    # Create a DataArray with boolean weights\n+    wgt = xr.DataArray(np.array([1, 1, 0], dtype=np.bool_))\n+\n+    # Calculate the weighted mean\n+    result = dta.weighted(wgt).mean()\n+\n+    # Assert that the incorrect result is produced\n+    expected = xr.DataArray(2.0)\n+    assert_equal(result, expected)\n",
  "test_inverted_patch": "diff --git a/xarray/tests/test_weighted_mean_boolean_inverted.py b/xarray/tests/test_weighted_mean_boolean_inverted.py\nnew file mode 100644\nindex 0000000..7066b66\n--- /dev/null\n+++ b/xarray/tests/test_weighted_mean_boolean_inverted.py\n@@ -0,0 +1,20 @@\n+import numpy as np\n+import xarray as xr\n+import pytest\n+from xarray.tests import assert_equal\n+\n+def test_weighted_mean_boolean_weights():\n+    # Create a DataArray with values\n+    dta = xr.DataArray([1.0, 1.0, 1.0])\n+    # Create a DataArray with boolean weights\n+    wgt = xr.DataArray(np.array([1, 1, 0], dtype=np.bool_))\n+\n+    # Calculate the weighted mean\n+    result = dta.weighted(wgt).mean()\n+\n+    # Assert that the correct result is produced\n+    expected = xr.DataArray(1.0)\n+    try:\n+        assert_equal(result, expected)\n+    except AssertionError:\n+        raise AssertionError(\"__BUG__HERE__\")\n",
  "num_sent_chars": 777147,
  "num_received_chars": 8010,
  "elapsed_time": 115.21324419975281,
  "lint_repair_count": 0,
  "test_generation_attempts": 0,
  "code_generation_attempts": 1,
  "pass_to_pass": true,
  "pass_to_fail": true,
  "fail_to_pass": true,
  "code_patch_score": 3,
  "appmap_data_test_status": null,
  "appmap_data_file_count": null,
  "appmap_data_context_size": null
}