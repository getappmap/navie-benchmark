{
  "instance_id": "django__django-13516",
  "edit_test_file": "tests/migrations/test_commands.py",
  "code_patch": "diff --git a/django/core/management/base.py b/django/core/management/base.py\nindex e6cbf8c..e737489 100644\n--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -143,12 +143,18 @@ class OutputWrapper(TextIOBase):\n     def isatty(self):\n         return hasattr(self._out, 'isatty') and self._out.isatty()\n \n+    def flush(self):\n+        \"\"\"Flush the underlying stream if it supports flushing.\"\"\"\n+        if hasattr(self._out, 'flush'):\n+            self._out.flush()\n+\n     def write(self, msg='', style_func=None, ending=None):\n         ending = self.ending if ending is None else ending\n         if ending and not msg.endswith(ending):\n             msg += ending\n         style_func = style_func or self.style_func\n         self._out.write(style_func(msg))\n+        self.flush()\n \n \n class BaseCommand:\n",
  "test_patch": "diff --git a/tests/migrations/test_migration_flush_output.py b/tests/migrations/test_migration_flush_output.py\nnew file mode 100644\nindex 0000000..b3cdd0d\n--- /dev/null\n+++ b/tests/migrations/test_migration_flush_output.py\n@@ -0,0 +1,36 @@\n+from io import StringIO\n+from django.test import TransactionTestCase\n+from django.core.management import call_command\n+from django.test.utils import override_settings\n+\n+\n+class MigrationFlushOutputTests(TransactionTestCase):\n+    \"\"\"Test migration command output flushing behavior.\"\"\"\n+    \n+    available_apps = ['migrations']\n+    databases = {'default'}\n+\n+    @override_settings(MIGRATION_MODULES={\"migrations\": \"migrations.test_migrations\"})\n+    def test_migration_flush_output_buffered(self):\n+        \"\"\"\n+        Test that migration command output is buffered and not flushed immediately.\n+        This reproduces the issue where migration progress isn't shown in real-time.\n+        \"\"\"\n+        out = StringIO()\n+        # Run migrations\n+        call_command('migrate', 'migrations', '0002', stdout=out, verbosity=1, no_color=True)\n+        output = out.getvalue()\n+        \n+        # The full output should appear, but it was buffered rather than streaming\n+        expected_output = (\n+            \"Operations to perform:\\n\"\n+            \"  Target specific migration: 0002_second, from migrations\\n\"\n+            \"Running migrations:\\n\"\n+            \"  Applying migrations.0001_initial... OK\\n\"\n+            \"  Applying migrations.0002_second... OK\\n\"\n+        )\n+        \n+        self.assertEqual(output, expected_output)\n+        \n+        # Reset migrations\n+        call_command('migrate', 'migrations', 'zero', verbosity=0)\n\\ No newline at end of file\n",
  "test_inverted_patch": "diff --git a/tests/migrations/test_migration_flush_output_inverted.py b/tests/migrations/test_migration_flush_output_inverted.py\nnew file mode 100644\nindex 0000000..5bd7566\n--- /dev/null\n+++ b/tests/migrations/test_migration_flush_output_inverted.py\n@@ -0,0 +1,47 @@\n+from io import StringIO\n+from django.test import TransactionTestCase\n+from django.core.management import call_command\n+from django.test.utils import override_settings\n+import time\n+\n+\n+class MigrationFlushOutputTests(TransactionTestCase):\n+    \"\"\"Test migration command output flushing behavior.\"\"\"\n+    \n+    available_apps = ['migrations']\n+    databases = {'default'}\n+\n+    @override_settings(MIGRATION_MODULES={\"migrations\": \"migrations.test_migrations\"})\n+    def test_migration_flush_output_not_buffered(self):\n+        \"\"\"\n+        Test that migration command output is not buffered and is flushed immediately.\n+        The test should fail if output is buffered instead of being shown in real-time.\n+        \"\"\"\n+        out = StringIO()\n+        \n+        # Run migrations and capture timestamps of output\n+        start_time = time.time()\n+        call_command('migrate', 'migrations', '0002', stdout=out, verbosity=1, no_color=True)\n+        end_time = time.time()\n+        output = out.getvalue()\n+        \n+        # Expected output chunks\n+        expected_chunks = [\n+            \"Operations to perform:\\n\",\n+            \"  Target specific migration: 0002_second, from migrations\\n\",\n+            \"Running migrations:\\n\",\n+            \"  Applying migrations.0001_initial... OK\\n\",\n+            \"  Applying migrations.0002_second... OK\\n\"\n+        ]\n+        \n+        # Verify all expected content is present\n+        for chunk in expected_chunks:\n+            self.assertIn(chunk, output)\n+        \n+        # If the execution time is very short (less than 0.1 seconds),\n+        # it means the output was buffered and not flushed in real-time\n+        if end_time - start_time < 0.1:\n+            raise AssertionError(\"__BUG__HERE__: Output was buffered instead of being flushed in real-time\")\n+            \n+        # Reset migrations\n+        call_command('migrate', 'migrations', 'zero', verbosity=0)\n\\ No newline at end of file\n",
  "num_sent_chars": 1222169,
  "num_received_chars": 11246,
  "elapsed_time": 159.65861201286316,
  "lint_repair_count": 0,
  "test_generation_attempts": 0,
  "code_generation_attempts": 3,
  "pass_to_pass": true,
  "pass_to_fail": false,
  "fail_to_pass": false,
  "code_patch_score": 1,
  "appmap_data_test_status": null,
  "appmap_data_file_count": null,
  "appmap_data_context_size": null
}