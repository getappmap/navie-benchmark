{
  "instance_id": "sphinx-doc__sphinx-10323",
  "edit_test_file": "tests/test_build_texinfo.py",
  "code_patch": "diff --git a/sphinx/directives/code.py b/sphinx/directives/code.py\nindex dc44ed3..68f23f5 100644\n--- a/sphinx/directives/code.py\n+++ b/sphinx/directives/code.py\n@@ -343,14 +343,22 @@ class LiteralIncludeReader:\n     def prepend_filter(self, lines: List[str], location: Tuple[str, int] = None) -> List[str]:\n         prepend = self.options.get('prepend')\n         if prepend:\n-            lines.insert(0, prepend + '\\n')\n+            # Determine the indentation level of the first line of the included content\n+            first_line_indent = len(lines[0]) - len(lines[0].lstrip())\n+            # Prepend with the same indentation level\n+            indented_prepend = ' ' * first_line_indent + prepend\n+            lines.insert(0, indented_prepend + '\\n')\n \n         return lines\n \n     def append_filter(self, lines: List[str], location: Tuple[str, int] = None) -> List[str]:\n         append = self.options.get('append')\n         if append:\n-            lines.append(append + '\\n')\n+            # Determine the indentation level of the last line of the included content\n+            last_line_indent = len(lines[-1]) - len(lines[-1].lstrip())\n+            # Append with the same indentation level\n+            indented_append = ' ' * last_line_indent + append\n+            lines.append(indented_append + '\\n')\n \n         return lines\n \n",
  "test_patch": "diff --git a/tests/test_literalinclude_prepend_formatting.py b/tests/test_literalinclude_prepend_formatting.py\nnew file mode 100644\nindex 0000000..eb160bf\n--- /dev/null\n+++ b/tests/test_literalinclude_prepend_formatting.py\n@@ -0,0 +1,58 @@\n+import os\n+from sphinx.directives.code import LiteralIncludeReader\n+from sphinx.config import Config\n+from unittest import TestCase\n+\n+DUMMY_CONFIG = Config({}, {})\n+\n+class TestLiteralIncludePrependFormatting(TestCase):\n+    def setUp(self):\n+        self.literal_inc_path = os.path.join(os.path.dirname(__file__), 'pom.xml')\n+        with open(self.literal_inc_path, 'w') as f:\n+            f.write(\"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project>\n+  <build>\n+    <plugins>\n+      <plugin>\n+        <groupId>org.apache.maven.plugins</groupId>\n+        <artifactId>maven-compiler-plugin</artifactId>\n+        <version>3.8.0</version>\n+        <configuration>\n+          <source>1.8</source>\n+          <target>1.8</target>\n+          <debug>true</debug>\n+          <encoding>UTF-8</encoding>\n+        </configuration>\n+      </plugin>\n+      <plugin>\n+        <groupId>com.github.ekryd.sortpom</groupId>\n+        <artifactId>sortpom-maven-plugin</artifactId>\n+        <version>2.15.0</version>\n+        <configuration>\n+          <verifyFailOn>strict</verifyFailOn>\n+        </configuration>\n+      </plugin>\n+    </plugins>\n+  </build>\n+</project>\"\"\")\n+\n+    def test_literalinclude_prepend_formatting(self):\n+        options = {\n+            'prepend': '</plugin>',\n+            'start-at': '<groupId>com.github.ekryd.sortpom</groupId>',\n+            'end-at': '</plugin>'\n+        }\n+        reader = LiteralIncludeReader(self.literal_inc_path, options, DUMMY_CONFIG)\n+        content, _ = reader.read()\n+        \n+        # Check if the prepend content is not indented correctly\n+        expected_output = \"\"\"<plugin>\n+        <groupId>com.github.ekryd.sortpom</groupId>\n+        <artifactId>sortpom-maven-plugin</artifactId>\n+        <version>2.15.0</version>\n+        <configuration>\n+          <verifyFailOn>strict</verifyFailOn>\n+        </configuration>\n+      </plugin>\"\"\"\n+        \n+        self.assertNotEqual(content.strip(), expected_output.strip(), \"The prepend content is incorrectly indented.\")\n",
  "test_inverted_patch": null,
  "num_sent_chars": 3684388,
  "num_received_chars": 47181,
  "elapsed_time": 343.8032398223877,
  "lint_repair_count": 0,
  "test_generation_attempts": 3,
  "code_generation_attempts": 9,
  "pass_to_pass": true,
  "pass_to_fail": false,
  "fail_to_pass": false,
  "code_patch_score": 1,
  "appmap_data_test_status": null,
  "appmap_data_file_count": null,
  "appmap_data_context_size": null
}