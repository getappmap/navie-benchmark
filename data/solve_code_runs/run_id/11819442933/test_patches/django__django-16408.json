{
  "edit_test_file": "tests/filtered_relation/tests.py",
  "test_patch": "diff --git a/tests/filtered_relation/test_filtered_relation_select_related.py b/tests/filtered_relation/test_filtered_relation_select_related.py\nnew file mode 100644\nindex 0000000..ba1dc23\n--- /dev/null\n+++ b/tests/filtered_relation/test_filtered_relation_select_related.py\n@@ -0,0 +1,52 @@\n+from django.test import TestCase\n+from django.db.models import FilteredRelation, Q\n+\n+from .models import Author, Book, Editor\n+\n+\n+class FilteredRelationSelectRelatedTests(TestCase):\n+    @classmethod\n+    def setUpTestData(cls):\n+        # Create authors\n+        cls.author1 = Author.objects.create(name=\"Author 1\")\n+        cls.author2 = Author.objects.create(name=\"Author 2\")\n+\n+        # Create editors\n+        cls.editor1 = Editor.objects.create(name=\"Editor 1\")\n+        cls.editor2 = Editor.objects.create(name=\"Editor 2\")\n+\n+        # Create books\n+        cls.book1 = Book.objects.create(\n+            title=\"Book 1\",\n+            author=cls.author1,\n+            editor=cls.editor1\n+        )\n+        cls.book2 = Book.objects.create(\n+            title=\"Book 2\",\n+            author=cls.author1,\n+            editor=cls.editor2\n+        )\n+        cls.book3 = Book.objects.create(\n+            title=\"Book 3\",\n+            author=cls.author2,\n+            editor=cls.editor1\n+        )\n+\n+    def test_wrong_related_object_assignment(self):\n+        \"\"\"\n+        Test that multi-level FilteredRelation with select_related() assigns\n+        incorrect related objects when chaining through multiple relations.\n+        \"\"\"\n+        books = Book.objects.annotate(\n+            author_editor=FilteredRelation(\n+                'author__book__editor',\n+                condition=Q(author__book__title__contains='Book')\n+            )\n+        ).select_related('author_editor').order_by('id')\n+\n+        # This assertion should fail because the related objects are incorrectly assigned\n+        self.assertEqual(\n+            books[0].editor,\n+            books[0].author_editor,\n+            \"FilteredRelation incorrectly assigns related objects\"\n+        )\n\\ No newline at end of file\n",
  "inverted_patch": null
}