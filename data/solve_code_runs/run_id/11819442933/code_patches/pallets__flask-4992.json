{
  "instance_id": "pallets__flask-4992",
  "edit_test_file": "tests/test_config.py",
  "code_patch": "diff --git a/src/flask/config.py b/src/flask/config.py\nindex d4fc310..3563ef8 100644\n--- a/src/flask/config.py\n+++ b/src/flask/config.py\n@@ -234,6 +234,7 @@ class Config(dict):\n         filename: str,\n         load: t.Callable[[t.IO[t.Any]], t.Mapping],\n         silent: bool = False,\n+        mode: str = \"r\",\n     ) -> bool:\n         \"\"\"Update the values in the config from a file that is loaded\n         using the ``load`` parameter. The loaded data is passed to the\n@@ -254,6 +255,8 @@ class Config(dict):\n         :type load: ``Callable[[Reader], Mapping]`` where ``Reader``\n             implements a ``read`` method.\n         :param silent: Ignore the file if it doesn't exist.\n+        :param mode: The mode to open the file in. Defaults to \"r\" (text mode).\n+            Use \"rb\" for binary mode if required by the loader.\n         :return: ``True`` if the file was loaded successfully.\n \n         .. versionadded:: 2.0\n@@ -261,7 +264,7 @@ class Config(dict):\n         filename = os.path.join(self.root_path, filename)\n \n         try:\n-            with open(filename) as f:\n+            with open(filename, mode=mode) as f:\n                 obj = load(f)\n         except OSError as e:\n             if silent and e.errno in (errno.ENOENT, errno.EISDIR):\n",
  "code_files": null,
  "test_patch": "diff --git a/tests/test_config_file_mode.py b/tests/test_config_file_mode.py\nnew file mode 100644\nindex 0000000..7ea863d\n--- /dev/null\n+++ b/tests/test_config_file_mode.py\n@@ -0,0 +1,28 @@\n+import os\n+import tomllib\n+import pytest\n+import flask\n+\n+def test_config_from_file_binary_mode():\n+    \"\"\"Test that Config.from_file() raises TypeError when used with tomllib.load\n+    since it doesn't support opening files in binary mode.\"\"\"\n+    app = flask.Flask(__name__)\n+    \n+    # Create a simple TOML config file\n+    current_dir = os.path.dirname(os.path.abspath(__file__))\n+    config_path = os.path.join(current_dir, \"static\", \"config.toml\")\n+    \n+    # Write some test TOML content\n+    os.makedirs(os.path.dirname(config_path), exist_ok=True)\n+    with open(config_path, \"wb\") as f:\n+        f.write(b'TEST_KEY = \"foo\"\\nSECRET_KEY = \"config\"\\n')\n+\n+    # Attempt to load TOML file - should raise TypeError about binary mode\n+    with pytest.raises(TypeError) as excinfo:\n+        app.config.from_file(\"static/config.toml\", load=tomllib.load)\n+\n+    # Verify the error message mentions binary mode\n+    assert \"binary mode\" in str(excinfo.value)\n+\n+    # Clean up the test file\n+    os.unlink(config_path)\n\\ No newline at end of file\n",
  "test_inverted_patch": "diff --git a/tests/test_config_file_mode_inverted.py b/tests/test_config_file_mode_inverted.py\nnew file mode 100644\nindex 0000000..0ed2cf5\n--- /dev/null\n+++ b/tests/test_config_file_mode_inverted.py\n@@ -0,0 +1,36 @@\n+import os\n+import tomllib\n+import pytest\n+import flask\n+\n+def test_config_from_file_binary_mode():\n+    \"\"\"Test that Config.from_file() supports binary mode for TOML files.\"\"\"\n+    app = flask.Flask(__name__)\n+    \n+    # Create a simple TOML config file\n+    current_dir = os.path.dirname(os.path.abspath(__file__))\n+    config_path = os.path.join(current_dir, \"static\", \"config.toml\")\n+    \n+    # Write some test TOML content\n+    os.makedirs(os.path.dirname(config_path), exist_ok=True)\n+    with open(config_path, \"wb\") as f:\n+        f.write(b'TEST_KEY = \"foo\"\\nSECRET_KEY = \"config\"\\n')\n+\n+    try:\n+        # This should work with a mode parameter\n+        app.config.from_file(\n+            \"static/config.toml\",\n+            load=tomllib.load,\n+            mode=\"rb\"\n+        )\n+    except (TypeError, AttributeError):\n+        # If the mode parameter is not supported or if TypeError is raised\n+        # due to binary mode issues, the bug is present\n+        raise AssertionError(\"__BUG__HERE__\")\n+    finally:\n+        # Clean up the test file\n+        os.unlink(config_path)\n+\n+    # If we get here, verify the config was actually loaded\n+    assert app.config[\"TEST_KEY\"] == \"foo\"\n+    assert app.config[\"SECRET_KEY\"] == \"config\"\n\\ No newline at end of file\n",
  "num_sent_chars": 5725276,
  "num_received_chars": 77982,
  "elapsed_time": 893.8907933235168,
  "lint_repair_count": 6,
  "test_generation_attempts": 1,
  "code_generation_attempts": 9,
  "pass_to_pass": true,
  "pass_to_fail": false,
  "fail_to_pass": true,
  "code_patch_score": 2,
  "appmap_data_test_status": null,
  "appmap_data_file_count": null,
  "appmap_data_context_size": null
}