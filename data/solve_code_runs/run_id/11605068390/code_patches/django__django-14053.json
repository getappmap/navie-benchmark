{
  "instance_id": "django__django-14053",
  "edit_test_file": "tests/staticfiles_tests/test_management.py",
  "code_patch": "diff --git a/django/contrib/staticfiles/storage.py b/django/contrib/staticfiles/storage.py\nindex 494890c..7108903 100644\n--- a/django/contrib/staticfiles/storage.py\n+++ b/django/contrib/staticfiles/storage.py\n@@ -212,7 +212,7 @@ class HashedFilesMixin:\n            refer to the cache-busting filenames.\n \n         If either of these are performed on a file, then that file is considered\n-        post-processed.\n+        post-processed. Each file is yielded only once after its final state is determined.\n         \"\"\"\n         # don't even dare to process the files if we're in dry run mode\n         if dry_run:\n@@ -220,6 +220,8 @@ class HashedFilesMixin:\n \n         # where to store the new paths\n         hashed_files = {}\n+        # track which files have been yielded to avoid duplicates\n+        yielded_files = set()\n \n         # build a list of adjustable files\n         adjustable_paths = [\n@@ -229,14 +231,18 @@ class HashedFilesMixin:\n         # Do a single pass first. Post-process all files once, then repeat for\n         # adjustable files.\n         for name, hashed_name, processed, _ in self._post_process(paths, adjustable_paths, hashed_files):\n-            yield name, hashed_name, processed\n+            if name not in yielded_files:\n+                yielded_files.add(name)\n+                yield name, hashed_name, processed\n \n         paths = {path: paths[path] for path in adjustable_paths}\n \n         for i in range(self.max_post_process_passes):\n             substitutions = False\n             for name, hashed_name, processed, subst in self._post_process(paths, adjustable_paths, hashed_files):\n-                yield name, hashed_name, processed\n+                if name not in yielded_files and (processed or subst):\n+                    yielded_files.add(name)\n+                    yield name, hashed_name, processed\n                 substitutions = substitutions or subst\n \n             if not substitutions:\n",
  "test_patch": "diff --git a/tests/staticfiles_tests/test_hashed_files_mixin.py b/tests/staticfiles_tests/test_hashed_files_mixin.py\nnew file mode 100644\nindex 0000000..81b96d6\n--- /dev/null\n+++ b/tests/staticfiles_tests/test_hashed_files_mixin.py\n@@ -0,0 +1,25 @@\n+import os\n+from io import StringIO\n+from django.core.management import call_command\n+from django.test import TestCase, override_settings\n+from django.contrib.staticfiles.storage import ManifestStaticFilesStorage\n+\n+class TestHashedFilesMixin(TestCase):\n+    @override_settings(STATICFILES_STORAGE='django.contrib.staticfiles.storage.ManifestStaticFilesStorage')\n+    def test_duplicate_yield_in_post_process(self):\n+        \"\"\"\n+        Test that HashedFilesMixin's post_process() yields multiple times for the same file.\n+        \"\"\"\n+        storage = ManifestStaticFilesStorage()\n+        with self.settings(STATICFILES_STORAGE='django.contrib.staticfiles.storage.ManifestStaticFilesStorage'):\n+            stdout = StringIO()\n+            call_command('collectstatic', interactive=False, verbosity=2, stdout=stdout)\n+            output = stdout.getvalue()\n+\n+            # Check for multiple yields of the same file\n+            base_css_count = output.count(\"Post-processed 'admin/css/base.css'\")\n+            dashboard_css_count = output.count(\"Post-processed 'admin/css/dashboard.css'\")\n+\n+            # Assert that the same file is yielded multiple times\n+            self.assertGreater(base_css_count, 1, \"Expected 'admin/css/base.css' to be post-processed multiple times.\")\n+            self.assertGreater(dashboard_css_count, 1, \"Expected 'admin/css/dashboard.css' to be post-processed multiple times.\")\n",
  "test_inverted_patch": "diff --git a/tests/staticfiles_tests/test_hashed_files_mixin_inverted.py b/tests/staticfiles_tests/test_hashed_files_mixin_inverted.py\nnew file mode 100644\nindex 0000000..e3c2d76\n--- /dev/null\n+++ b/tests/staticfiles_tests/test_hashed_files_mixin_inverted.py\n@@ -0,0 +1,25 @@\n+import os\n+from io import StringIO\n+from django.core.management import call_command\n+from django.test import TestCase, override_settings\n+from django.contrib.staticfiles.storage import ManifestStaticFilesStorage\n+\n+class TestHashedFilesMixin(TestCase):\n+    @override_settings(STATICFILES_STORAGE='django.contrib.staticfiles.storage.ManifestStaticFilesStorage')\n+    def test_duplicate_yield_in_post_process(self):\n+        \"\"\"\n+        Test that HashedFilesMixin's post_process() does not yield multiple times for the same file.\n+        \"\"\"\n+        storage = ManifestStaticFilesStorage()\n+        with self.settings(STATICFILES_STORAGE='django.contrib.staticfiles.storage.ManifestStaticFilesStorage'):\n+            stdout = StringIO()\n+            call_command('collectstatic', interactive=False, verbosity=2, stdout=stdout)\n+            output = stdout.getvalue()\n+\n+            # Check for multiple yields of the same file\n+            base_css_count = output.count(\"Post-processed 'admin/css/base.css'\")\n+            dashboard_css_count = output.count(\"Post-processed 'admin/css/dashboard.css'\")\n+\n+            # Assert that the same file is not yielded multiple times\n+            if base_css_count > 1 or dashboard_css_count > 1:\n+                raise AssertionError(\"__BUG__HERE__\")\n",
  "num_sent_chars": 731363,
  "num_received_chars": 9889,
  "elapsed_time": 142.9076669216156,
  "lint_repair_count": 0,
  "test_generation_attempts": 0,
  "code_generation_attempts": 1,
  "pass_to_pass": true,
  "pass_to_fail": true,
  "fail_to_pass": true,
  "code_patch_score": 3,
  "appmap_data_test_status": null,
  "appmap_data_file_count": null,
  "appmap_data_context_size": null
}