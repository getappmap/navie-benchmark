{
  "instance_id": "scikit-learn__scikit-learn-26194",
  "edit_test_file": "sklearn/metrics/tests/test_ranking.py",
  "code_patch": "diff --git a/sklearn/metrics/_ranking.py b/sklearn/metrics/_ranking.py\nindex 0cdead9..472421e 100644\n--- a/sklearn/metrics/_ranking.py\n+++ b/sklearn/metrics/_ranking.py\n@@ -1083,7 +1083,16 @@ def roc_curve(\n     # to make sure that the curve starts at (0, 0)\n     tps = np.r_[0, tps]\n     fps = np.r_[0, fps]\n-    thresholds = np.r_[thresholds[0] + 1, thresholds]\n+    \n+    # Check if scores are probabilities (between 0 and 1)\n+    is_prob = np.all((y_score >= 0) & (y_score <= 1))\n+    \n+    # For probabilities, use 1.0 as max threshold\n+    # For other scores, add 1 to max score as before\n+    if is_prob:\n+        thresholds = np.r_[1.0, thresholds]\n+    else:\n+        thresholds = np.r_[thresholds[0] + 1, thresholds]\n \n     if fps[-1] <= 0:\n         warnings.warn(\n",
  "test_patch": "diff --git a/sklearn/metrics/tests/test_probabilities.py b/sklearn/metrics/tests/test_probabilities.py\nnew file mode 100644\nindex 0000000..7547c50\n--- /dev/null\n+++ b/sklearn/metrics/tests/test_probabilities.py\n@@ -0,0 +1,9 @@\n+import numpy as np\n+from sklearn.metrics import roc_curve\n+\n+def test_roc_curve_with_probability_estimates():\n+    rng = np.random.RandomState(42)\n+    y_true = rng.randint(0, 2, size=10)\n+    y_score = rng.rand(10)\n+    _, _, thresholds = roc_curve(y_true, y_score)\n+    assert (thresholds > 1).any(), \"Thresholds should exceed 1 to reproduce the issue\"\n",
  "test_inverted_patch": "diff --git a/sklearn/metrics/tests/test_probabilities_inverted.py b/sklearn/metrics/tests/test_probabilities_inverted.py\nnew file mode 100644\nindex 0000000..5620560\n--- /dev/null\n+++ b/sklearn/metrics/tests/test_probabilities_inverted.py\n@@ -0,0 +1,10 @@\n+import numpy as np\n+from sklearn.metrics import roc_curve\n+\n+def test_roc_curve_with_probability_estimates():\n+    rng = np.random.RandomState(42)\n+    y_true = rng.randint(0, 2, size=10)\n+    y_score = rng.rand(10)\n+    _, _, thresholds = roc_curve(y_true, y_score)\n+    if (thresholds > 1).any():\n+        raise AssertionError(\"__BUG__HERE__\")\n",
  "num_sent_chars": 4842890,
  "num_received_chars": 82666,
  "elapsed_time": 979.1663937568665,
  "lint_repair_count": 6,
  "test_generation_attempts": 0,
  "code_generation_attempts": 9,
  "pass_to_pass": false,
  "pass_to_fail": true,
  "fail_to_pass": true,
  "code_patch_score": 2,
  "appmap_data_test_status": null,
  "appmap_data_file_count": null,
  "appmap_data_context_size": null
}