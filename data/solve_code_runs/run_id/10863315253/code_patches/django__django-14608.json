{
  "instance_id": "django__django-14608",
  "edit_test_file": "tests/forms_tests/tests/test_error_messages.py",
  "code_patch": "diff --git a/django/forms/formsets.py b/django/forms/formsets.py\nindex a89c355..45412cd 100644\n--- a/django/forms/formsets.py\n+++ b/django/forms/formsets.py\n@@ -295,6 +295,8 @@ class BaseFormSet:\n         \"\"\"\n         if self._non_form_errors is None:\n             self.full_clean()\n+        # Add 'nonform' CSS class to non-form errors\n+        self._non_form_errors.error_class = 'nonform'\n         return self._non_form_errors\n \n     @property\n@@ -333,7 +335,8 @@ class BaseFormSet:\n         self._non_form_errors.\n         \"\"\"\n         self._errors = []\n-        self._non_form_errors = self.error_class()\n+        # Initialize _non_form_errors with 'nonform' CSS class\n+        self._non_form_errors = self.error_class(error_class='nonform')\n         empty_forms_count = 0\n \n         if not self.is_bound:  # Stop further processing.\n",
  "test_patch": "diff --git a/tests/forms_tests/tests/test_formset_errorlist.py b/tests/forms_tests/tests/test_formset_errorlist.py\nnew file mode 100644\nindex 0000000..29bafae\n--- /dev/null\n+++ b/tests/forms_tests/tests/test_formset_errorlist.py\n@@ -0,0 +1,24 @@\n+from django.forms import formset_factory, Form, CharField\n+from django.forms.utils import ErrorList\n+from django.test import SimpleTestCase\n+\n+class CustomErrorList(ErrorList):\n+    def __str__(self):\n+        return self.as_ul()\n+\n+    def as_ul(self):\n+        if not self:\n+            return ''\n+        return '<ul class=\"errorlist nonform\">%s</ul>' % ''.join('<li>%s</li>' % e for e in self)\n+\n+class TestForm(Form):\n+    name = CharField()\n+\n+class FormSetErrorListTest(SimpleTestCase):\n+    def test_non_form_errors_have_nonform_class(self):\n+        TestFormSet = formset_factory(TestForm, extra=0)\n+        formset = TestFormSet(data={}, error_class=CustomErrorList)\n+        formset.is_valid()  # Trigger validation to populate errors\n+\n+        # Check if non-form errors have the 'nonform' CSS class\n+        self.assertIn('class=\"errorlist nonform\"', str(formset.non_form_errors()))\n\\ No newline at end of file\n",
  "test_inverted_patch": "diff --git a/tests/forms_tests/tests/test_formset_errorlist_inverted.py b/tests/forms_tests/tests/test_formset_errorlist_inverted.py\nnew file mode 100644\nindex 0000000..030232f\n--- /dev/null\n+++ b/tests/forms_tests/tests/test_formset_errorlist_inverted.py\n@@ -0,0 +1,26 @@\n+from django.forms import formset_factory, Form, CharField\n+from django.forms.utils import ErrorList\n+from django.test import SimpleTestCase\n+\n+class CustomErrorList(ErrorList):\n+    def __str__(self):\n+        return self.as_ul()\n+\n+    def as_ul(self):\n+        if not self:\n+            return ''\n+        return '<ul class=\"errorlist nonform\">%s</ul>' % ''.join('<li>%s</li>' % e for e in self)\n+\n+class TestForm(Form):\n+    name = CharField()\n+\n+class FormSetErrorListTest(SimpleTestCase):\n+    def test_non_form_errors_have_nonform_class(self):\n+        TestFormSet = formset_factory(TestForm, extra=0)\n+        formset = TestFormSet(data={}, error_class=CustomErrorList)\n+        formset.is_valid()  # Trigger validation to populate errors\n+\n+        # Check if non-form errors have the 'nonform' CSS class\n+        # This assertion should now fail if the bug is present\n+        if 'class=\"errorlist nonform\"' in str(formset.non_form_errors()):\n+            raise AssertionError(\"__BUG__HERE__\")\n\\ No newline at end of file\n",
  "num_sent_chars": 780573,
  "num_received_chars": 42331,
  "elapsed_time": 306.78247928619385,
  "lint_repair_count": 3,
  "test_generation_attempts": 0,
  "code_generation_attempts": 9,
  "pass_to_pass": true,
  "pass_to_fail": false,
  "fail_to_pass": false,
  "code_patch_score": 1,
  "appmap_data_test_status": "PASSED",
  "appmap_data_file_count": 1,
  "appmap_data_context_size": 16458
}