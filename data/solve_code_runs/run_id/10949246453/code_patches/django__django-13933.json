{
  "instance_id": "django__django-13933",
  "edit_test_file": "tests/model_forms/test_modelchoicefield.py",
  "code_patch": "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 422bc5d..bcf5915 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -1188,7 +1188,7 @@ class ModelChoiceField(ChoiceField):\n     # This class is a subclass of ChoiceField for purity, but it doesn't\n     # actually use any of ChoiceField's implementation.\n     default_error_messages = {\n-        'invalid_choice': _('Select a valid choice. That choice is not one of'\n+        'invalid_choice': _('Select a valid choice. %(value)s is not one of'\n                             ' the available choices.'),\n     }\n     iterator = ModelChoiceIterator\n@@ -1284,7 +1284,7 @@ class ModelChoiceField(ChoiceField):\n                 value = getattr(value, key)\n             value = self.queryset.get(**{key: value})\n         except (ValueError, TypeError, self.queryset.model.DoesNotExist):\n-            raise ValidationError(self.error_messages['invalid_choice'], code='invalid_choice')\n+            raise ValidationError(self.error_messages['invalid_choice'], code='invalid_choice', params={'value': value})\n         return value\n \n     def validate(self, value):\n",
  "test_patch": "diff --git a/tests/model_forms/test_modelchoicefield_invalid_choice.py b/tests/model_forms/test_modelchoicefield_invalid_choice.py\nnew file mode 100644\nindex 0000000..bc56314\n--- /dev/null\n+++ b/tests/model_forms/test_modelchoicefield_invalid_choice.py\n@@ -0,0 +1,36 @@\n+from django import forms\n+from django.core.exceptions import ValidationError\n+from django.test import TestCase\n+\n+from .models import Category\n+\n+\n+class ModelChoiceFieldInvalidChoiceTest(TestCase):\n+    @classmethod\n+    def setUpTestData(cls):\n+        cls.c1 = Category.objects.create(name='Entertainment', slug='entertainment', url='entertainment')\n+        cls.c2 = Category.objects.create(name='A test', slug='test', url='test')\n+\n+    def test_modelchoicefield_invalid_choice_error_message(self):\n+        f = forms.ModelChoiceField(Category.objects.all())\n+        \n+        invalid_choice = 999  # An ID that doesn't exist\n+        \n+        with self.assertRaises(ValidationError) as cm:\n+            f.clean(invalid_choice)\n+        \n+        error_message = str(cm.exception)\n+        self.assertNotIn(str(invalid_choice), error_message)\n+        self.assertEqual(error_message, \"['Select a valid choice. That choice is not one of the available choices.']\")\n+\n+    def test_modelmultiplechoicefield_invalid_choice_error_message(self):\n+        f = forms.ModelMultipleChoiceField(Category.objects.all())\n+        \n+        invalid_choice = 999  # An ID that doesn't exist\n+        \n+        with self.assertRaises(ValidationError) as cm:\n+            f.clean([self.c1.pk, invalid_choice])\n+        \n+        error_message = str(cm.exception)\n+        self.assertIn(str(invalid_choice), error_message)\n+        self.assertEqual(error_message, f\"['Select a valid choice. {invalid_choice} is not one of the available choices.']\")\n\\ No newline at end of file\n",
  "test_inverted_patch": "diff --git a/tests/model_forms/test_modelchoicefield_invalid_choice_inverted.py b/tests/model_forms/test_modelchoicefield_invalid_choice_inverted.py\nnew file mode 100644\nindex 0000000..8942c6f\n--- /dev/null\n+++ b/tests/model_forms/test_modelchoicefield_invalid_choice_inverted.py\n@@ -0,0 +1,42 @@\n+from django import forms\n+from django.core.exceptions import ValidationError\n+from django.test import TestCase\n+\n+from .models import Category\n+\n+\n+class ModelChoiceFieldInvalidChoiceTest(TestCase):\n+    @classmethod\n+    def setUpTestData(cls):\n+        cls.c1 = Category.objects.create(name='Entertainment', slug='entertainment', url='entertainment')\n+        cls.c2 = Category.objects.create(name='A test', slug='test', url='test')\n+\n+    def test_modelchoicefield_invalid_choice_error_message(self):\n+        f = forms.ModelChoiceField(Category.objects.all())\n+        \n+        invalid_choice = 999  # An ID that doesn't exist\n+        \n+        with self.assertRaises(ValidationError) as cm:\n+            f.clean(invalid_choice)\n+        \n+        error_message = str(cm.exception)\n+        \n+        # This test should now fail when the bug is present\n+        if str(invalid_choice) not in error_message:\n+            raise AssertionError(\"__BUG__HERE__\")\n+        \n+        expected_message = f\"Select a valid choice. {invalid_choice} is not one of the available choices.\"\n+        self.assertEqual(error_message, f\"['{expected_message}']\")\n+\n+    def test_modelmultiplechoicefield_invalid_choice_error_message(self):\n+        f = forms.ModelMultipleChoiceField(Category.objects.all())\n+        \n+        invalid_choice = 999  # An ID that doesn't exist\n+        \n+        with self.assertRaises(ValidationError) as cm:\n+            f.clean([self.c1.pk, invalid_choice])\n+        \n+        error_message = str(cm.exception)\n+        self.assertIn(str(invalid_choice), error_message)\n+        expected_message = f\"Select a valid choice. {invalid_choice} is not one of the available choices.\"\n+        self.assertEqual(error_message, f\"['{expected_message}']\")\n\\ No newline at end of file\n",
  "num_sent_chars": 1336786,
  "num_received_chars": 79088,
  "elapsed_time": 445.31049370765686,
  "lint_repair_count": 6,
  "test_generation_attempts": 1,
  "code_generation_attempts": 9,
  "pass_to_pass": false,
  "pass_to_fail": true,
  "fail_to_pass": true,
  "code_patch_score": 2,
  "appmap_data_test_status": null,
  "appmap_data_file_count": null,
  "appmap_data_context_size": null
}