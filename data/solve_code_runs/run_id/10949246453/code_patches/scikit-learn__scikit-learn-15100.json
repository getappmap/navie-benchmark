{
  "instance_id": "scikit-learn__scikit-learn-15100",
  "edit_test_file": "sklearn/utils/tests/test_utils.py",
  "code_patch": "diff --git a/sklearn/feature_extraction/text.py b/sklearn/feature_extraction/text.py\nindex bb5a9d6..11236d9 100644\n--- a/sklearn/feature_extraction/text.py\n+++ b/sklearn/feature_extraction/text.py\n@@ -130,10 +130,7 @@ def strip_accents_unicode(s):\n         ASCII equivalent.\n     \"\"\"\n     normalized = unicodedata.normalize('NFKD', s)\n-    if normalized == s:\n-        return s\n-    else:\n-        return ''.join([c for c in normalized if not unicodedata.combining(c)])\n+    return ''.join([c for c in normalized if not unicodedata.combining(c)])\n \n \n def strip_accents_ascii(s):\n",
  "test_patch": "diff --git a/sklearn/utils/tests/test_strip_accents_unicode.py b/sklearn/utils/tests/test_strip_accents_unicode.py\nnew file mode 100644\nindex 0000000..d230eda\n--- /dev/null\n+++ b/sklearn/utils/tests/test_strip_accents_unicode.py\n@@ -0,0 +1,23 @@\n+import pytest\n+from sklearn.feature_extraction.text import strip_accents_unicode\n+\n+def test_strip_accents_unicode_nfkd_form():\n+    # Test that strip_accents_unicode fails to strip accents from strings already in NFKD form\n+\n+    # String with one code point, \"LATIN SMALL LETTER N WITH TILDE\"\n+    s1 = chr(241)\n+\n+    # String with two code points, \"LATIN SMALL LETTER N\" followed by \"COMBINING TILDE\"\n+    s2 = chr(110) + chr(771)\n+\n+    # Ensure the strings are visually identical\n+    assert s1 != s2  # They are not equal as Python strings, but visually identical\n+\n+    # Check that strip_accents_unicode works as expected for s1\n+    assert strip_accents_unicode(s1) == 'n'\n+\n+    # Check that strip_accents_unicode fails to strip accent from s2\n+    assert strip_accents_unicode(s2) == s2\n+\n+    # The expected behavior would be:\n+    # assert strip_accents_unicode(s2) == 'n'\n\\ No newline at end of file\n",
  "test_inverted_patch": "diff --git a/sklearn/utils/tests/test_strip_accents_unicode_inverted.py b/sklearn/utils/tests/test_strip_accents_unicode_inverted.py\nnew file mode 100644\nindex 0000000..2b3adfb\n--- /dev/null\n+++ b/sklearn/utils/tests/test_strip_accents_unicode_inverted.py\n@@ -0,0 +1,25 @@\n+import pytest\n+from sklearn.feature_extraction.text import strip_accents_unicode\n+\n+def test_strip_accents_unicode_nfkd_form():\n+    # Test that strip_accents_unicode fails to strip accents from strings already in NFKD form\n+\n+    # String with one code point, \"LATIN SMALL LETTER N WITH TILDE\"\n+    s1 = chr(241)\n+\n+    # String with two code points, \"LATIN SMALL LETTER N\" followed by \"COMBINING TILDE\"\n+    s2 = chr(110) + chr(771)\n+\n+    # Ensure the strings are visually identical\n+    assert s1 != s2  # They are not equal as Python strings, but visually identical\n+\n+    # Check that strip_accents_unicode works as expected for s1\n+    assert strip_accents_unicode(s1) == 'n'\n+\n+    # Check that strip_accents_unicode strips accent from s2\n+    stripped_s2 = strip_accents_unicode(s2)\n+    if stripped_s2 == s2:\n+        raise AssertionError(\"__BUG__HERE__\")\n+    \n+    # The expected behavior:\n+    assert stripped_s2 == 'n', f\"Expected 'n', but got '{stripped_s2}'\"\n",
  "num_sent_chars": 766328,
  "num_received_chars": 20814,
  "elapsed_time": 172.66274428367615,
  "lint_repair_count": 0,
  "test_generation_attempts": 5,
  "code_generation_attempts": 1,
  "pass_to_pass": true,
  "pass_to_fail": true,
  "fail_to_pass": true,
  "code_patch_score": 3,
  "appmap_data_test_status": null,
  "appmap_data_file_count": null,
  "appmap_data_context_size": null
}