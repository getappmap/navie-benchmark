{
  "edit_test_file": "astropy/modeling/tests/test_separable.py",
  "test_patch": "diff --git a/astropy/modeling/tests/test_separability_matrix_bug.py b/astropy/modeling/tests/test_separability_matrix_bug.py\nnew file mode 100644\nindex 0000000..2a87e2d\n--- /dev/null\n+++ b/astropy/modeling/tests/test_separability_matrix_bug.py\n@@ -0,0 +1,23 @@\n+import numpy as np\n+from numpy.testing import assert_allclose\n+from astropy.modeling import models as m\n+from astropy.modeling.separable import separability_matrix\n+\n+def test_separability_matrix_nested_compound_models():\n+    # Create a simple compound model\n+    cm = m.Linear1D(10) & m.Linear1D(5)\n+    \n+    # Create a more complex compound model\n+    complex_cm = m.Pix2Sky_TAN() & m.Linear1D(10) & m.Linear1D(5)\n+    \n+    # Create a nested compound model\n+    nested_cm = m.Pix2Sky_TAN() & cm\n+    \n+    # Expected separability matrix for the nested compound model\n+    expected_matrix = np.array([[True, True, False, False],\n+                                [True, True, False, False],\n+                                [False, False, True, True],\n+                                [False, False, True, True]])\n+    \n+    # Assert that the separability matrix of the nested compound model is incorrect\n+    assert_allclose(separability_matrix(nested_cm), expected_matrix)\n",
  "inverted_patch": "diff --git a/astropy/modeling/tests/test_separability_matrix_bug_inverted.py b/astropy/modeling/tests/test_separability_matrix_bug_inverted.py\nnew file mode 100644\nindex 0000000..1d7ad40\n--- /dev/null\n+++ b/astropy/modeling/tests/test_separability_matrix_bug_inverted.py\n@@ -0,0 +1,27 @@\n+import numpy as np\n+from numpy.testing import assert_allclose\n+from astropy.modeling import models as m\n+from astropy.modeling.separable import separability_matrix\n+\n+def test_separability_matrix_nested_compound_models():\n+    # Create a simple compound model\n+    cm = m.Linear1D(10) & m.Linear1D(5)\n+    \n+    # Create a more complex compound model\n+    complex_cm = m.Pix2Sky_TAN() & m.Linear1D(10) & m.Linear1D(5)\n+    \n+    # Create a nested compound model\n+    nested_cm = m.Pix2Sky_TAN() & cm\n+    \n+    # Expected separability matrix for the nested compound model\n+    expected_matrix = np.array([[True, True, False, False],\n+                                [True, True, False, False],\n+                                [False, False, True, False],\n+                                [False, False, False, True]])\n+    \n+    # Assert that the separability matrix of the nested compound model is incorrect\n+    actual_matrix = separability_matrix(nested_cm)\n+    try:\n+        assert_allclose(actual_matrix, expected_matrix)\n+    except AssertionError:\n+        raise AssertionError(\"__BUG__HERE__\")\n"
}