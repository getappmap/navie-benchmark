{
  "edit_test_file": "tests/migrations/test_optimizer.py",
  "test_patch": "diff --git a/tests/migrations/test_optimize_create_alter_model.py b/tests/migrations/test_optimize_create_alter_model.py\nnew file mode 100644\nindex 0000000..b546a2f\n--- /dev/null\n+++ b/tests/migrations/test_optimize_create_alter_model.py\n@@ -0,0 +1,53 @@\n+from django.db import migrations, models\n+from django.db.migrations.optimizer import MigrationOptimizer\n+from django.db.migrations.serializer import serializer_factory\n+from django.test import SimpleTestCase\n+\n+from .models import EmptyManager, UnicodeModel\n+\n+class OptimizeCreateAlterModelTests(SimpleTestCase):\n+    def optimize(self, operations, app_label):\n+        optimizer = MigrationOptimizer()\n+        return optimizer.optimize(operations, app_label), optimizer._iterations\n+\n+    def serialize(self, value):\n+        return serializer_factory(value).serialize()[0]\n+\n+    def assertOptimizesTo(self, operations, expected, app_label=None):\n+        result, _ = self.optimize(operations, app_label or \"migrations\")\n+        result = [self.serialize(f) for f in result]\n+        expected = [self.serialize(f) for f in expected]\n+        self.assertEqual(expected, result)\n+\n+    def test_create_model_alter_managers(self):\n+        \"\"\"\n+        Test that CreateModel followed by AlterModelManagers does not optimize\n+        to just CreateModel with managers.\n+        \"\"\"\n+        managers = [(\"objects\", EmptyManager())]\n+        self.assertOptimizesTo(\n+            [\n+                migrations.CreateModel(\n+                    name=\"Foo\",\n+                    fields=[(\"name\", models.CharField(max_length=255))],\n+                    options={\"verbose_name\": \"Foo\"},\n+                    bases=(UnicodeModel,),\n+                ),\n+                migrations.AlterModelManagers(\n+                    name=\"Foo\",\n+                    managers=managers,\n+                ),\n+            ],\n+            [\n+                migrations.CreateModel(\n+                    name=\"Foo\",\n+                    fields=[(\"name\", models.CharField(max_length=255))],\n+                    options={\"verbose_name\": \"Foo\"},\n+                    bases=(UnicodeModel,),\n+                ),\n+                migrations.AlterModelManagers(\n+                    name=\"Foo\",\n+                    managers=managers,\n+                ),\n+            ],\n+        )\n\\ No newline at end of file\n",
  "inverted_patch": "diff --git a/tests/migrations/test_optimize_create_alter_model_inverted.py b/tests/migrations/test_optimize_create_alter_model_inverted.py\nnew file mode 100644\nindex 0000000..e91762b\n--- /dev/null\n+++ b/tests/migrations/test_optimize_create_alter_model_inverted.py\n@@ -0,0 +1,53 @@\n+from django.db import migrations, models\n+from django.db.migrations.optimizer import MigrationOptimizer\n+from django.db.migrations.serializer import serializer_factory\n+from django.test import SimpleTestCase\n+\n+from .models import EmptyManager, UnicodeModel\n+\n+class OptimizeCreateAlterModelTests(SimpleTestCase):\n+    def optimize(self, operations, app_label):\n+        optimizer = MigrationOptimizer()\n+        return optimizer.optimize(operations, app_label), optimizer._iterations\n+\n+    def serialize(self, value):\n+        return serializer_factory(value).serialize()[0]\n+\n+    def assertOptimizesTo(self, operations, expected, app_label=None):\n+        result, _ = self.optimize(operations, app_label or \"migrations\")\n+        result = [self.serialize(f) for f in result]\n+        expected = [self.serialize(f) for f in expected]\n+        self.assertEqual(expected, result)\n+\n+    def test_create_model_alter_managers(self):\n+        \"\"\"\n+        Test that CreateModel followed by AlterModelManagers does not optimize\n+        to just CreateModel with managers.\n+        \"\"\"\n+        managers = [(\"objects\", EmptyManager())]\n+        try:\n+            self.assertOptimizesTo(\n+                [\n+                    migrations.CreateModel(\n+                        name=\"Foo\",\n+                        fields=[(\"name\", models.CharField(max_length=255))],\n+                        options={\"verbose_name\": \"Foo\"},\n+                        bases=(UnicodeModel,),\n+                    ),\n+                    migrations.AlterModelManagers(\n+                        name=\"Foo\",\n+                        managers=managers,\n+                    ),\n+                ],\n+                [\n+                    migrations.CreateModel(\n+                        name=\"Foo\",\n+                        fields=[(\"name\", models.CharField(max_length=255))],\n+                        options={\"verbose_name\": \"Foo\"},\n+                        bases=(UnicodeModel,),\n+                        managers=managers,  # Expecting managers to be included in CreateModel\n+                    ),\n+                ],\n+            )\n+        except AssertionError:\n+            raise AssertionError(\"__BUG__HERE__\")\n\\ No newline at end of file\n"
}