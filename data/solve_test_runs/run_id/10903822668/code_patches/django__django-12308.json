{
  "instance_id": "django__django-12308",
  "edit_test_file": "tests/forms_tests/field_tests/test_jsonfield.py",
  "code_patch": "diff --git a/django/contrib/admin/utils.py b/django/contrib/admin/utils.py\nindex e4ddc8f..99836a6 100644\n--- a/django/contrib/admin/utils.py\n+++ b/django/contrib/admin/utils.py\n@@ -379,6 +379,7 @@ def help_text_for_field(name, model):\n \n def display_for_field(value, field, empty_value_display):\n     from django.contrib.admin.templatetags.admin_list import _boolean_icon\n+    from django.forms import JSONField\n \n     if getattr(field, 'flatchoices', None):\n         return dict(field.flatchoices).get(value, empty_value_display)\n@@ -394,6 +395,8 @@ def display_for_field(value, field, empty_value_display):\n         return formats.localize(value)\n     elif isinstance(field, models.DecimalField):\n         return formats.number_format(value, field.decimal_places)\n+    elif isinstance(field, JSONField):\n+        return field.prepare_value(value)\n     elif isinstance(field, (models.IntegerField, models.FloatField)):\n         return formats.number_format(value)\n     elif isinstance(field, models.FileField) and value:\n",
  "test_patch": "diff --git a/tests/forms_tests/field_tests/test_displayforfield_jsonfield.py b/tests/forms_tests/field_tests/test_displayforfield_jsonfield.py\nnew file mode 100644\nindex 0000000..12e86b8\n--- /dev/null\n+++ b/tests/forms_tests/field_tests/test_displayforfield_jsonfield.py\n@@ -0,0 +1,19 @@\n+import json\n+from django.forms import JSONField, Form\n+from django.test import SimpleTestCase\n+from django.contrib.admin.utils import display_for_field\n+\n+class DisplayForFieldJSONFieldTest(SimpleTestCase):\n+    def test_jsonfield_readonly_display(self):\n+        class JSONForm(Form):\n+            json_field = JSONField()\n+\n+        form = JSONForm(initial={'json_field': {'foo': 'bar'}})\n+        field = form.fields['json_field']\n+        value = form.initial['json_field']\n+\n+        # Simulate the readonly display in admin\n+        displayed_value = display_for_field(value, field, 'json_field')\n+\n+        # Assert that the incorrect output is produced\n+        self.assertEqual(displayed_value, \"{'foo': 'bar'}\")\n\\ No newline at end of file\n",
  "test_inverted_patch": "diff --git a/tests/forms_tests/field_tests/test_displayforfield_jsonfield_inverted.py b/tests/forms_tests/field_tests/test_displayforfield_jsonfield_inverted.py\nnew file mode 100644\nindex 0000000..42bc981\n--- /dev/null\n+++ b/tests/forms_tests/field_tests/test_displayforfield_jsonfield_inverted.py\n@@ -0,0 +1,21 @@\n+import json\n+from django.forms import JSONField, Form\n+from django.test import SimpleTestCase\n+from django.contrib.admin.utils import display_for_field\n+\n+class DisplayForFieldJSONFieldTest(SimpleTestCase):\n+    def test_jsonfield_readonly_display(self):\n+        class JSONForm(Form):\n+            json_field = JSONField()\n+\n+        form = JSONForm(initial={'json_field': {'foo': 'bar'}})\n+        field = form.fields['json_field']\n+        value = form.initial['json_field']\n+\n+        # Simulate the readonly display in admin\n+        displayed_value = display_for_field(value, field, 'json_field')\n+\n+        # Assert that the incorrect output is produced\n+        # This should now fail when the bug is observed\n+        if displayed_value == \"{'foo': 'bar'}\":\n+            raise AssertionError(\"__BUG__HERE__\")\n\\ No newline at end of file\n",
  "num_sent_chars": 324662,
  "num_received_chars": 8261,
  "elapsed_time": 70.77889084815979,
  "lint_repair_count": 0,
  "test_generation_attempts": 1,
  "code_generation_attempts": 1,
  "pass_to_pass": true,
  "pass_to_fail": true,
  "fail_to_pass": true,
  "code_patch_score": 3,
  "appmap_data_test_status": null,
  "appmap_data_file_count": null,
  "appmap_data_context_size": null
}