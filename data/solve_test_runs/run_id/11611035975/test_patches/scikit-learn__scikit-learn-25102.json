{
  "edit_test_file": "sklearn/utils/tests/test_set_output.py",
  "test_patch": "diff --git a/sklearn/utils/tests/test_preserve_dtypes.py b/sklearn/utils/tests/test_preserve_dtypes.py\nnew file mode 100644\nindex 0000000..5fe0e9d\n--- /dev/null\n+++ b/sklearn/utils/tests/test_preserve_dtypes.py\n@@ -0,0 +1,24 @@\n+import numpy as np\n+import pandas as pd\n+from sklearn.datasets import load_iris\n+from sklearn.feature_selection import SelectKBest\n+from sklearn.feature_selection import chi2\n+\n+def test_preserve_dtypes_issue():\n+    \"\"\"Test to reproduce the dtype preservation issue with pandas output.\"\"\"\n+    X, y = load_iris(return_X_y=True, as_frame=True)\n+    X = X.astype(\n+        {\n+            \"petal width (cm)\": np.float16,\n+            \"petal length (cm)\": np.float16,\n+        }\n+    )\n+    X[\"cat\"] = y.astype(\"category\")\n+\n+    selector = SelectKBest(chi2, k=2)\n+    selector.set_output(transform=\"pandas\")\n+    X_out = selector.fit_transform(X, y)\n+\n+    # Assert that the dtypes are not preserved, which is the current issue\n+    expected_dtypes = pd.Series([np.float64, np.float64], index=[\"petal length (cm)\", \"cat\"])\n+    pd.testing.assert_series_equal(X_out.dtypes, expected_dtypes)\n",
  "inverted_patch": "diff --git a/sklearn/utils/tests/test_preserve_dtypes_inverted.py b/sklearn/utils/tests/test_preserve_dtypes_inverted.py\nnew file mode 100644\nindex 0000000..dfdd9f0\n--- /dev/null\n+++ b/sklearn/utils/tests/test_preserve_dtypes_inverted.py\n@@ -0,0 +1,28 @@\n+import numpy as np\n+import pandas as pd\n+from sklearn.datasets import load_iris\n+from sklearn.feature_selection import SelectKBest\n+from sklearn.feature_selection import chi2\n+import pytest\n+\n+def test_preserve_dtypes_issue():\n+    \"\"\"Test to reproduce the dtype preservation issue with pandas output.\"\"\"\n+    X, y = load_iris(return_X_y=True, as_frame=True)\n+    X = X.astype(\n+        {\n+            \"petal width (cm)\": np.float16,\n+            \"petal length (cm)\": np.float16,\n+        }\n+    )\n+    X[\"cat\"] = y.astype(\"category\")\n+\n+    selector = SelectKBest(chi2, k=2)\n+    selector.set_output(transform=\"pandas\")\n+    X_out = selector.fit_transform(X, y)\n+\n+    # Assert that the dtypes are preserved, which is the desired behavior\n+    expected_dtypes = pd.Series([np.float16, \"category\"], index=[\"petal length (cm)\", \"cat\"])\n+    try:\n+        pd.testing.assert_series_equal(X_out.dtypes, expected_dtypes)\n+    except AssertionError:\n+        raise AssertionError(\"__BUG__HERE__\")\n"
}