{
  "edit_test_file": "tests/aggregation/tests.py",
  "test_patch": "diff --git a/tests/aggregation/test_strip_unused_annotations.py b/tests/aggregation/test_strip_unused_annotations.py\nnew file mode 100644\nindex 0000000..ad4d67e\n--- /dev/null\n+++ b/tests/aggregation/test_strip_unused_annotations.py\n@@ -0,0 +1,38 @@\n+import datetime\n+from decimal import Decimal\n+from django.db.models import Count\n+from django.test import TestCase\n+from .models import Author, Book, Publisher, Store\n+\n+class CountAnnotationStripTestCase(TestCase):\n+    @classmethod\n+    def setUpTestData(cls):\n+        cls.a1 = Author.objects.create(name=\"Adrian Holovaty\", age=34)\n+        cls.p1 = Publisher.objects.create(name=\"Apress\", num_awards=3)\n+        cls.b1 = Book.objects.create(\n+            isbn=\"159059725\",\n+            name=\"The Definitive Guide to Django: Web Development Done Right\",\n+            pages=447,\n+            rating=4.5,\n+            price=Decimal(\"30.00\"),\n+            contact=cls.a1,\n+            publisher=cls.p1,\n+            pubdate=datetime.date(2007, 12, 6),\n+        )\n+        cls.b2 = Book.objects.create(\n+            isbn=\"067232959\",\n+            name=\"Sams Teach Yourself Django in 24 Hours\",\n+            pages=528,\n+            rating=3.0,\n+            price=Decimal(\"23.09\"),\n+            contact=cls.a1,\n+            publisher=cls.p1,\n+            pubdate=datetime.date(2008, 3, 3),\n+        )\n+\n+    def test_count_with_unused_annotation(self):\n+        # This test reproduces the issue where an unused annotation is not stripped\n+        # from the count query, leading to unnecessary complexity in the SQL.\n+        count_with_annotation = Book.objects.annotate(Count('authors')).count()\n+        count_without_annotation = Book.objects.count()\n+        self.assertEqual(count_with_annotation, count_without_annotation)\n\\ No newline at end of file\n",
  "inverted_patch": "diff --git a/tests/aggregation/test_strip_unused_annotations_inverted.py b/tests/aggregation/test_strip_unused_annotations_inverted.py\nnew file mode 100644\nindex 0000000..6cfd768\n--- /dev/null\n+++ b/tests/aggregation/test_strip_unused_annotations_inverted.py\n@@ -0,0 +1,39 @@\n+import datetime\n+from decimal import Decimal\n+from django.db.models import Count\n+from django.test import TestCase\n+from .models import Author, Book, Publisher, Store\n+\n+class CountAnnotationStripTestCase(TestCase):\n+    @classmethod\n+    def setUpTestData(cls):\n+        cls.a1 = Author.objects.create(name=\"Adrian Holovaty\", age=34)\n+        cls.p1 = Publisher.objects.create(name=\"Apress\", num_awards=3)\n+        cls.b1 = Book.objects.create(\n+            isbn=\"159059725\",\n+            name=\"The Definitive Guide to Django: Web Development Done Right\",\n+            pages=447,\n+            rating=4.5,\n+            price=Decimal(\"30.00\"),\n+            contact=cls.a1,\n+            publisher=cls.p1,\n+            pubdate=datetime.date(2007, 12, 6),\n+        )\n+        cls.b2 = Book.objects.create(\n+            isbn=\"067232959\",\n+            name=\"Sams Teach Yourself Django in 24 Hours\",\n+            pages=528,\n+            rating=3.0,\n+            price=Decimal(\"23.09\"),\n+            contact=cls.a1,\n+            publisher=cls.p1,\n+            pubdate=datetime.date(2008, 3, 3),\n+        )\n+\n+    def test_count_with_unused_annotation(self):\n+        # This test should fail if the unused annotation is not stripped\n+        # from the count query, indicating the presence of the bug.\n+        count_with_annotation = Book.objects.annotate(Count('authors')).count()\n+        count_without_annotation = Book.objects.count()\n+        if count_with_annotation == count_without_annotation:\n+            raise AssertionError(\"__BUG__HERE__\")\n\\ No newline at end of file\n"
}