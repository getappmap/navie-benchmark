{
  "edit_test_file": "tests/test_directive_code.py",
  "test_patch": "diff --git a/tests/test_source_read_include.py b/tests/test_source_read_include.py\nnew file mode 100644\nindex 0000000..ad99005\n--- /dev/null\n+++ b/tests/test_source_read_include.py\n@@ -0,0 +1,78 @@\n+import os\n+import unittest\n+from sphinx.application import Sphinx\n+\n+class TestSourceReadInclude(unittest.TestCase):\n+    def setUp(self):\n+        self.srcdir = os.path.abspath('.')\n+        self.outdir = os.path.join(self.srcdir, '_build')\n+        self.confdir = self.srcdir\n+        self.doctreedir = os.path.join(self.outdir, '.doctrees')\n+        self.buildername = 'html'\n+\n+        # Create necessary files for the test\n+        os.makedirs(self.outdir, exist_ok=True)\n+        with open(os.path.join(self.srcdir, 'conf.py'), 'w', encoding='utf-8') as f:\n+            f.write(\"\"\"\n+import sys\n+import os\n+\n+sys.path.insert(0, os.path.abspath('.'))\n+\n+extensions = [\n+    'my-extension'\n+]\n+\"\"\")\n+        with open(os.path.join(self.srcdir, 'index.rst'), 'w', encoding='utf-8') as f:\n+            f.write(\"\"\"\n+This is a test\n+==============\n+\n+.. include:: something-to-include.rst\n+\n+&REPLACE_ME;\n+\"\"\")\n+        with open(os.path.join(self.srcdir, 'something-to-include.rst'), 'w', encoding='utf-8') as f:\n+            f.write(\"\"\"\n+Testing\n+=======\n+\n+&REPLACE_ME;\n+\"\"\")\n+        with open(os.path.join(self.srcdir, 'my-extension.py'), 'w', encoding='utf-8') as f:\n+            f.write(\"\"\"\n+from sphinx.application import Sphinx\n+\n+def subst_vars_replace(app: Sphinx, docname, source):\n+    result = source[0]\n+    result = result.replace(\"&REPLACE_ME;\", \"REPLACED\")\n+    source[0] = result\n+\n+def setup(app: Sphinx):\n+    app.connect('source-read', subst_vars_replace)\n+    return dict(\n+        version='1.0',\n+        parallel_read_safe=True,\n+        parallel_write_safe=True\n+    )\n+\"\"\")\n+\n+    def test_source_read_include(self):\n+        app = Sphinx(\n+            srcdir=self.srcdir,\n+            confdir=self.confdir,\n+            outdir=self.outdir,\n+            doctreedir=self.doctreedir,\n+            buildername=self.buildername,\n+            confoverrides={'extensions': ['my-extension']},\n+        )\n+        app.build()\n+\n+        # Check if the issue is reproduced\n+        with open(os.path.join(self.outdir, 'index.html'), 'r', encoding='utf-8') as f:\n+            content = f.read()\n+            self.assertIn('&amp;REPLACE_ME;', content)\n+            self.assertIn('REPLACED', content)\n+\n+if __name__ == '__main__':\n+    unittest.main()\n\\ No newline at end of file\n",
  "inverted_patch": "diff --git a/tests/test_source_read_include_inverted.py b/tests/test_source_read_include_inverted.py\nnew file mode 100644\nindex 0000000..0f08924\n--- /dev/null\n+++ b/tests/test_source_read_include_inverted.py\n@@ -0,0 +1,80 @@\n+import os\n+import unittest\n+from sphinx.application import Sphinx\n+\n+class TestSourceReadInclude(unittest.TestCase):\n+    def setUp(self):\n+        self.srcdir = os.path.abspath('.')\n+        self.outdir = os.path.join(self.srcdir, '_build')\n+        self.confdir = self.srcdir\n+        self.doctreedir = os.path.join(self.outdir, '.doctrees')\n+        self.buildername = 'html'\n+\n+        # Create necessary files for the test\n+        os.makedirs(self.outdir, exist_ok=True)\n+        with open(os.path.join(self.srcdir, 'conf.py'), 'w', encoding='utf-8') as f:\n+            f.write(\"\"\"\n+import sys\n+import os\n+\n+sys.path.insert(0, os.path.abspath('.'))\n+\n+extensions = [\n+    'my-extension'\n+]\n+\"\"\")\n+        with open(os.path.join(self.srcdir, 'index.rst'), 'w', encoding='utf-8') as f:\n+            f.write(\"\"\"\n+This is a test\n+==============\n+\n+.. include:: something-to-include.rst\n+\n+&REPLACE_ME;\n+\"\"\")\n+        with open(os.path.join(self.srcdir, 'something-to-include.rst'), 'w', encoding='utf-8') as f:\n+            f.write(\"\"\"\n+Testing\n+=======\n+\n+&REPLACE_ME;\n+\"\"\")\n+        with open(os.path.join(self.srcdir, 'my-extension.py'), 'w', encoding='utf-8') as f:\n+            f.write(\"\"\"\n+from sphinx.application import Sphinx\n+\n+def subst_vars_replace(app: Sphinx, docname, source):\n+    result = source[0]\n+    result = result.replace(\"&REPLACE_ME;\", \"REPLACED\")\n+    source[0] = result\n+\n+def setup(app: Sphinx):\n+    app.connect('source-read', subst_vars_replace)\n+    return dict(\n+        version='1.0',\n+        parallel_read_safe=True,\n+        parallel_write_safe=True\n+    )\n+\"\"\")\n+\n+    def test_source_read_include(self):\n+        app = Sphinx(\n+            srcdir=self.srcdir,\n+            confdir=self.confdir,\n+            outdir=self.outdir,\n+            doctreedir=self.doctreedir,\n+            buildername=self.buildername,\n+            confoverrides={'extensions': ['my-extension']},\n+        )\n+        app.build()\n+\n+        # Check if the issue is reproduced\n+        with open(os.path.join(self.outdir, 'index.html'), 'r', encoding='utf-8') as f:\n+            content = f.read()\n+            # Alter the test to fail when the issue is observed\n+            if '&amp;REPLACE_ME;' in content:\n+                raise AssertionError(\"__BUG__HERE__\")\n+            self.assertIn('REPLACED', content)\n+\n+if __name__ == '__main__':\n+    unittest.main()\n\\ No newline at end of file\n"
}