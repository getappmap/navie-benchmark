{
  "instance_id": "django__django-16560",
  "edit_test_file": "tests/constraints/tests.py",
  "code_patch": "diff --git a/django/db/models/constraints.py b/django/db/models/constraints.py\nindex 075ecee..e9095f3 100644\n--- a/django/db/models/constraints.py\n+++ b/django/db/models/constraints.py\n@@ -19,10 +19,11 @@ __all__ = [\"BaseConstraint\", \"CheckConstraint\", \"Deferrable\", \"UniqueConstraint\"\n class BaseConstraint:\n     default_violation_error_message = _(\"Constraint \u201c%(name)s\u201d is violated.\")\n     violation_error_message = None\n+    violation_error_code = None\n \n     # RemovedInDjango60Warning: When the deprecation ends, replace with:\n-    # def __init__(self, *, name, violation_error_message=None):\n-    def __init__(self, *args, name=None, violation_error_message=None):\n+    # def __init__(self, *, name, violation_error_message=None, violation_error_code=None):\n+    def __init__(self, *args, name=None, violation_error_message=None, violation_error_code=None):\n         # RemovedInDjango60Warning.\n         if name is None and not args:\n             raise TypeError(\n@@ -34,6 +35,8 @@ class BaseConstraint:\n             self.violation_error_message = violation_error_message\n         else:\n             self.violation_error_message = self.default_violation_error_message\n+        if violation_error_code is not None:\n+            self.violation_error_code = violation_error_code\n         # RemovedInDjango60Warning.\n         if args:\n             warnings.warn(\n@@ -65,6 +68,9 @@ class BaseConstraint:\n     def get_violation_error_message(self):\n         return self.violation_error_message % {\"name\": self.name}\n \n+    def get_violation_error_code(self):\n+        return self.violation_error_code\n+\n     def deconstruct(self):\n         path = \"%s.%s\" % (self.__class__.__module__, self.__class__.__name__)\n         path = path.replace(\"django.db.models.constraints\", \"django.db.models\")\n@@ -112,7 +118,10 @@ class CheckConstraint(BaseConstraint):\n         against = instance._get_field_value_map(meta=model._meta, exclude=exclude)\n         try:\n             if not Q(self.check).check(against, using=using):\n-                raise ValidationError(self.get_violation_error_message())\n+                raise ValidationError(\n+                    self.get_violation_error_message(),\n+                    code=self.get_violation_error_code()\n+                )\n         except FieldError:\n             pass\n \n",
  "test_patch": "diff --git a/tests/constraints/test_base_constraint_validation_error.py b/tests/constraints/test_base_constraint_validation_error.py\nnew file mode 100644\nindex 0000000..79e63fd\n--- /dev/null\n+++ b/tests/constraints/test_base_constraint_validation_error.py\n@@ -0,0 +1,15 @@\n+from django.core.exceptions import ValidationError\n+from django.test import SimpleTestCase\n+from django.db.models.constraints import BaseConstraint\n+\n+class BaseConstraintValidationErrorTest(SimpleTestCase):\n+    def test_validate_custom_code(self):\n+        class CustomConstraint(BaseConstraint):\n+            def validate(self, model_instance, model_class):\n+                raise ValidationError(\"Custom error message\", code=\"custom_code\")\n+\n+        constraint = CustomConstraint(name=\"custom_constraint\")\n+        with self.assertRaises(ValidationError) as cm:\n+            constraint.validate(None, None)\n+        \n+        self.assertEqual(cm.exception.code, \"custom_code\")\n\\ No newline at end of file\n",
  "test_inverted_patch": "diff --git a/tests/constraints/test_base_constraint_validation_error_inverted.py b/tests/constraints/test_base_constraint_validation_error_inverted.py\nnew file mode 100644\nindex 0000000..3a12286\n--- /dev/null\n+++ b/tests/constraints/test_base_constraint_validation_error_inverted.py\n@@ -0,0 +1,16 @@\n+from django.core.exceptions import ValidationError\n+from django.test import SimpleTestCase\n+from django.db.models.constraints import BaseConstraint\n+\n+class BaseConstraintValidationErrorTest(SimpleTestCase):\n+    def test_validate_custom_code(self):\n+        class CustomConstraint(BaseConstraint):\n+            def validate(self, model_instance, model_class):\n+                raise ValidationError(\"Custom error message\", code=\"custom_code\")\n+\n+        constraint = CustomConstraint(name=\"custom_constraint\")\n+        with self.assertRaises(ValidationError) as cm:\n+            constraint.validate(None, None)\n+        \n+        # Altered assertion to make the test fail when the issue is observed\n+        self.assertEqual(cm.exception.code, \"__BUG__HERE__\")\n\\ No newline at end of file\n",
  "num_sent_chars": 802993,
  "num_received_chars": 92399,
  "elapsed_time": 644.960066318512,
  "lint_repair_count": 2,
  "test_generation_attempts": 0,
  "code_generation_attempts": 9,
  "pass_to_pass": true,
  "pass_to_fail": false,
  "fail_to_pass": false,
  "code_patch_score": 1,
  "appmap_data_test_status": "PASSED",
  "appmap_data_file_count": 1,
  "appmap_data_context_size": null
}